<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Storybound</title>
    <style>
        body { font-family: 'Georgia', serif; background: #121212; color: #e0e0e0; margin: 0; padding: 0; }
        #container { max-width: 800px; margin: 50px auto; padding: 40px; background: #1e1e1e; border-radius: 12px; box-shadow: 0 4px 40px rgba(0,0,0,0.8); }
        h1 { text-align: center; color: #ff6b6b; font-size: 42px; margin-bottom: 10px; }
        #welcome { text-align: center; font-size: 24px; margin-bottom: 60px; opacity: 0.9; }
        button { background: #ff6b6b; color: white; border: none; padding: 18px 36px; margin: 20px 10px; border-radius: 8px; cursor: pointer; font-size: 20px; }
        button:hover { background: #ff8787; }
        input, textarea, select { width: 100%; padding: 18px; margin: 15px 0; background: #2c2c2c; color: #e0e0e0; border: 1px solid #444; border-radius: 8px; box-sizing: border-box; font-size: 18px; }
        label { display: block; margin-top: 50px; font-weight: bold; font-size: 22px; }
        #story { white-space: pre-wrap; margin-top: 50px; padding: 40px; background: #252525; border-radius: 8px; min-height: 500px; line-height: 1.9; font-size: 20px; }
        .hidden { display: none !important; }
        .style-preview { font-style: italic; margin: 30px 0; padding: 30px; background: #333; border-radius: 8px; font-size: 19px; }
        #invitation-text { white-space: pre-line; width: 100%; padding: 25px; font-size: 17px; }
        #turn-indicator { text-align: center; font-size: 32px; margin: 50px 0; color: #ff6b6b; }
    </style>
</head>
<body>
    <div id="container">
        <h1>Storybound</h1>
        <p id="welcome">Immersive Romantasy Storytelling for Solo or Couples</p>

        <div id="setup">
            <label>Play Mode:</label>
            <select id="mode">
                <option value="solo">Solo</option>
                <option value="couples">Couples (Alternating Turns)</option>
            </select>

            <label>Genre:</label>
            <select id="genre">
                <option>High Fantasy</option>
                <option>Dark Romantasy</option>
                <option>Enemies to Lovers</option>
                <option>Fae Court Intrigue</option>
                <option>Dragon Shifter</option>
            </select>

            <label>Story Style:</label>
            <select id="style">
                <option value="breathless">Breathless Romance</option>
                <option value="epic">Epic Fantasy</option>
                <option value="dark">Dark Desire</option>
                <option value="playful">Playful Tease</option>
                <option value="intense">Intense Passion</option>
            </select>
            <button onclick="showPreview()">Preview Style</button>
            <div id="preview" class="style-preview hidden"></div>

            <label>Your Character Name:</label>
            <input type="text" id="char1" placeholder="e.g., Elara">

            <div id="couples-extra" class="hidden">
                <label>Partner's Character Name:</label>
                <input type="text" id="char2" placeholder="e.g., Thorne">
            </div>

            <label>Starting Scene or Prompt:</label>
            <textarea id="prompt" rows="6" placeholder="Describe the opening scene or any custom elements..."></textarea>

            <button onclick="startStory()">Begin Story</button>
        </div>

        <div id="game" class="hidden">
            <h2 id="turn-indicator">Your Turn</h2>
            <div id="story"></div>
            <textarea id="input" rows="8" placeholder="Continue the story..."></textarea>
            <div style="text-align:center; margin-top:40px;">
                <button onclick="continueStory()">Submit Turn</button>
                <button onclick="generateInvitation()">Generate Invite Link/Text</button>
            </div>
            <textarea id="invitation-text" rows="10" readonly class="hidden"></textarea>
        </div>
    </div>

    <script>
        window.onload = function() {
            document.getElementById('game').classList.add('hidden');
            document.getElementById('setup').classList.remove('hidden');
            document.getElementById('couples-extra').classList.add('hidden');
            document.getElementById('preview').classList.add('hidden');
        };

        const API_URL = 'https://storybound-proxy.vercel.app/proxy';

        let mode, genre, style, char1, char2, story = '', currentPlayer = 1;

        const stylePreviews = {
            breathless: "His fingers brushed her skin, sending shivers through her body as their breaths mingled in the heated air...",
            epic: "In the shadow of ancient mountains, the chosen warrior faced the dragon lord, destiny hanging by a thread...",
            dark: "Shadows coiled around them as forbidden desires awakened, pulling them into a dangerous dance of power and surrender...",
            playful: "She teased him with a wicked grin, her laughter echoing as sparks flew between them in playful challenge...",
            intense: "Their bodies crashed together in raw need, hearts pounding as passion consumed every restraint..."
        };

        function showPreview() {
            const selected = document.getElementById('style').value;
            const previewDiv = document.getElementById('preview');
            previewDiv.textContent = stylePreviews[selected] || 'No preview available.';
            previewDiv.classList.remove('hidden');
        }

        function startStory() {
            mode = document.getElementById('mode').value;
            genre = document.getElementById('genre').value;
            style = document.getElementById('style').value;
            char1 = document.getElementById('char1').value.trim() || 'You';
            char2 = (mode === 'couples') ? (document.getElementById('char2').value.trim() || 'Your Partner') : '';

            if (mode === 'couples') {
                document.getElementById('couples-extra').classList.remove('hidden');
            }

            let systemPrompt = `You are a masterful romantasy storyteller writing in third-person perspective. Use seductive, immersive language. Characters: Player 1 is ${char1}${mode === 'couples' ? `, Player 2 is ${char2}` : ''}. Genre: ${genre}. Style: ${style === 'breathless' ? 'breathless and romantic' : style === 'epic' ? 'grand and epic' : style === 'dark' ? 'dark and intense' : style === 'playful' ? 'playful and teasing' : 'intensely passionate'}. Keep responses 300-500 words, richly descriptive, ending in a way that invites the next turn.`;

            const userPrompt = document.getElementById('prompt').value.trim();
            if (userPrompt) systemPrompt += ` Starting prompt: ${userPrompt}`;

            fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    model: 'grok-4',
                    messages: [{ role: 'system', content: systemPrompt }],
                    temperature: 0.9
                })
            })
            .then(res => res.json())
            .then(data => {
                story = data.choices[0].message.content.trim();
                document.getElementById('story').textContent = story;
                document.getElementById('setup').classList.add('hidden');
                document.getElementById('game').classList.remove('hidden');
                updateTurn();
            })
            .catch(err => {
                console.error(err);
                document.getElementById('story').textContent = 'Story generation failed â€” check console or proxy.';
            });
        }

        function continueStory() {
            const input = document.getElementById('input').value.trim();
            if (!input) return;

            story += `\n\n[${currentPlayer === 1 ? char1 : char2}'s action: ${input}]`;

            fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    model: 'grok-4',
                    messages: [{ role: 'user', content: `Continue the story in third-person, richly descriptive. Full story so far:\n${story}` }],
                    temperature: 0.9
                })
            })
            .then(res => res.json())
            .then(data => {
                const addition = data.choices[0].message.content.trim();
                story += '\n\n' + addition;
                document.getElementById('story').textContent = story;
                document.getElementById('input').value = '';
                currentPlayer = mode === 'couples' ? (currentPlayer === 1 ? 2 : 1) : 1;
                updateTurn();
            });
        }

        function updateTurn() {
            document.getElementById('turn-indicator').textContent = mode === 'couples' 
                ? (currentPlayer === 1 ? `${char1}'s Turn` : `${char2}'s Turn`)
                : 'Your Turn';
        }

        function generateInvitation() {
            const styleText = document.getElementById('style').options[document.getElementById('style').selectedIndex].text;
            const inviteText = `Join me in Storybound!

Genre: ${genre}
Style: ${styleText}
Your character: ${char2 || 'Your Partner'}

Current story:

${story}

Continue with your action!

Play at: https://storybound-app.vercel.app`;

            const textarea = document.getElementById('invitation-text');
            textarea.value = inviteText;
            textarea.classList.remove('hidden');
            textarea.select();
            document.execCommand('copy');
            alert('Invitation copied to clipboard!');
        }
    </script>
</body>
</html>

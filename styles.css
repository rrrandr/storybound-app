/* GLOBAL VARS */
:root { 
    --bg1: #0a001f; --bg2: #2a0033; --pink: #ff69b4; --hot: #ff1493; --gold: #ffd700; --ink: #f0e6ff; --panel: rgba(20,0,40,.6); 
    --btn-bg: linear-gradient(145deg, #8b008b, var(--hot)); --btn-txt: var(--gold);
    --p1-color: #B0E0E6; --p2-color: #FFB6C1;
    --font-main: 'Lora', serif; 
    --font-story: 'Lora', serif;
    --story-size: 1.15em;
    --line-height: 1.8; 
    --letter-spacing: 0.02em;
    --cursor-url: url('https://raw.githubusercontent.com/rrrandr/storybound-app/1347ea65b81435cf03275d95aab21db4b1af8579/cursor-dollar-plane-64.png') 2 2;
}

/* THEMES */
body.theme-sepia { --bg1:#2c2218; --bg2:#3e2f22; --pink:#d2b48c; --hot:#8b4513; --gold:#ffa500; --ink:#f5deb3; --panel:rgba(40,30,20,0.8); --btn-bg:#5c4033; --btn-txt:#f5deb3; }
body.theme-midnight { --bg1:#000000; --bg2:#111111; --pink:#444; --hot:#666; --gold:#888; --ink:#ccc; --panel:rgba(20,20,20,0.9); --btn-bg:#333; --btn-txt:#aaa; }
body.theme-print { --bg1:#e0e0e0; --bg2:#f0f0f0; --pink:#333; --hot:#000; --gold:#444; --ink:#111; --panel:rgba(255,255,255,0.95); --btn-bg:#ccc; --btn-txt:#000; }
body.theme-easy { --bg1:#fffdd0; --bg2:#fff8c0; --pink:#333; --hot:#000; --gold:#555; --ink:#000; --panel:rgba(255,255,240,0.95); --btn-bg:#000; --btn-txt:#fff; }

/* Print Fixes */
body.theme-print .fate-card h3, body.theme-easy .fate-card h3 { color: #000 !important; text-shadow: none !important; font-weight: bold; }
body.theme-print .section-title, body.theme-easy .section-title { text-shadow: none; color: var(--hot); }

html, body { margin:0; padding:0; background:linear-gradient(135deg,var(--bg1),var(--bg2)); color:var(--ink); font-family:var(--font-main); overflow-x:hidden; min-height:100vh; }
body { text-align:center; padding:10px; transition: background 0.3s, color 0.3s; }

/* UTILITY CLASSES */
.hidden { display:none !important; }
.overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 3000; display: flex; align-items: center; justify-content: center; flex-direction: column; }

/* TYPOGRAPHY */
h1, h2, .section-title { font-family:'lust-script-display','lust-script',serif !important; color:var(--pink); text-shadow:0 0 15px var(--hot); font-weight:400; }
.section-title { font-size:2.2em; margin:35px 0 15px; border-top:1px solid rgba(255,105,180,0.2); padding-top:20px; }
.instruction-text { font-family: 'Lora', serif; font-size: 0.65em; color: var(--ink); opacity: 0.7; vertical-align: middle; margin-left: 8px; letter-spacing: 0; text-shadow: none; font-weight: normal; display:inline-block; }
.subtitle { font-size: 1.2em; color: var(--gold); font-style: italic; opacity: 0.9; margin-bottom: 30px; }

/* LAYOUT GRID */
.grid-2-col { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; width: 95%; margin: 20px auto 0; }
@media (max-width: 600px) { .grid-2-col { grid-template-columns: 1fr; } }

/* STORY READING EXPERIENCE */
#storyText { 
    text-align: left; 
    max-width: 100%; 
    min-height: 300px; 
    margin-bottom: 20px; 
    font-size: var(--story-size); 
    line-height: var(--line-height); 
    letter-spacing: var(--letter-spacing);
    font-family: var(--font-story);
}
#storyText p { margin-bottom: 1.5em; }

.story-image {
    max-width: 100%;
    border-radius: 10px;
    margin: 14px 0;
    border: 1px solid rgba(255,105,180,0.25);
    box-shadow: 0 0 18px rgba(0,0,0,0.35);
}

/* DECISION SNAPSHOTS */
.decision-snapshot {
    text-align: center;
    color: var(--gold);
    font-style: italic;
    border-top: 1px solid var(--pink);
    border-bottom: 1px solid var(--pink);
    padding: 15px 10px;
    margin: 25px 0;
    background: rgba(0,0,0,0.3);
    font-family: 'lust-script-display', serif;
    font-size: 1.2em;
    line-height: 1.4;
}
.decision-snapshot span {
    display: block;
    font-family: var(--font-main);
    font-size: 0.6em;
    text-transform: uppercase;
    letter-spacing: 2px;
    opacity: 0.7;
    margin-bottom: 5px;
    color: var(--ink);
}

/* DIALOGUE */
.dialogue-block { display: block; margin: 15px 0; padding-left: 20px; border-left: 3px solid rgba(255,255,255,0.2); font-style: italic; font-weight: 500; font-size: 1.1em; }
.p1-dia { color: var(--p1-color); border-color: var(--p1-color); }
.p2-dia { color: var(--p2-color); border-color: var(--p2-color); }

/* BUTTONS */
button { background:var(--btn-bg); color:var(--btn-txt); padding:10px 30px; border:none; border-radius:25px; font-size:1em; cursor:pointer; box-shadow:0 0 18px rgba(0,0,0,0.2); transition:.3s; font-family:var(--font-main); position:relative; }
button:hover { transform:scale(1.05); filter:brightness(1.2); }
button:disabled { opacity:0.5; cursor:not-allowed; transform:none; }
.small-btn { font-size: 0.9em; padding: 8px 16px; background: #444; color:#fff; box-shadow:none; }

/* UTILS */
.box { max-width:600px; margin:20px auto; padding:25px; background:var(--panel); border:1px solid var(--pink); border-radius:15px; box-shadow:0 0 20px rgba(0,0,0,0.2); }

/* CHOICE BUTTONS - Responsive Stack */
.choice-buttons { 
    display:flex; 
    flex-wrap:wrap; 
    gap:20px; 
    justify-content:center; 
    margin:30px auto; 
    max-width:800px; 
}
.choice-buttons > div {
    flex: 1 1 200px;
    max-width: 300px;
}
@media (max-width: 640px) {
    .choice-buttons { flex-direction: column; align-items: center; width: 100%; }
    .choice-buttons > div { width: 100%; max-width: 100%; flex: 1 1 100%; }
    .choice { width: 100%; }
}

.choice { padding:15px 40px; font-size:1.4em; border-radius:30px; font-family:'lust-script-display',serif; width: 100%; box-sizing: border-box; }
.choice-desc { opacity:0.7; max-width:250px; margin:10px auto; }

/* INPUTS & LOCKS */
.input-wrapper { position: relative; width: 95%; margin: 0 auto 15px; overflow:hidden; }
.input-wrapper label, .setting-label { display:block; text-align:center; color:var(--gold); margin-bottom:5px; font-size:0.9em; font-family:var(--font-main); text-transform:uppercase; letter-spacing:1px; }
textarea, input, select { width:100%; padding:15px; background:rgba(0,0,0,0.3); color:var(--ink); border:1px solid var(--pink); border-radius:8px; font-size:1em; font-family:var(--font-main); box-sizing:border-box; }

/* GHOST TEXT / PILL GRID */
.ghost-overlay {
    position: absolute; top: 0; left: 0; right: 0; bottom: 0;
    pointer-events: none; overflow: hidden; padding: 10px;
    background: rgba(0,0,0,0.2);
}
.ghost-grid {
    display: flex; flex-wrap: wrap; align-content: flex-start; gap: 6px;
    height: 100%; width: 100%;
}

/* LOCKS & CURSOR */
.locked-input textarea, .locked-style, .card.locked, .fate-card.locked, .intensity-btn.locked { 
    opacity:0.6; filter:grayscale(0.9); 
    cursor: var(--cursor-url), pointer !important; 
    pointer-events: auto !important; 
}
.locked-input, .locked-style, .card.locked, .fate-card.locked, .intensity-btn.locked {
    position: relative;
}
.locked-style { display: inline-block; }

/* HANDCUFF OVERLAY - SVG */
.locked-input::after, .locked-style::after, .card.locked::after, .fate-card.locked::after, .intensity-btn.locked::after { 
    content:""; position:absolute; 
    top:5px; right:5px; 
    width:24px; height:24px; 
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M17.5 13.5a3.5 3.5 0 1 0-2.5-5.9l-1.5 1.5'%3E%3C/path%3E%3Cpath d='M6.5 10.5a3.5 3.5 0 1 0 2.5 5.9l1.5-1.5'%3E%3C/path%3E%3Cpath d='M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0-2 0'%3E%3C/path%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: center;
    background-size: contain;
    opacity:0.9; 
    pointer-events:none; 
    z-index: 10; 
    filter: drop-shadow(0 0 2px black);
}
.locked-input::after { top: 40px; right: 10px; } 

/* STYLE CARDS */
.style-cards { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:15px; margin:15px 0; }
.card { background:#252525; border-radius:12px; padding:15px; cursor:pointer; text-align:left; border:2px solid transparent; position:relative; transition:.2s; }
.card:hover { transform:translateY(-3px); border-color:#ff6b6b; }
.card.selected { border-color:#ff69b4; background:#333; box-shadow:0 0 15px rgba(255,105,180,0.3); }
.card h3 { margin:0 0 5px; color:#ff6b6b; font-size:1.1em; font-family:'lust-script-display',serif; }
.card p { font-size:0.9em; opacity:0.9; margin:0; font-family:var(--font-main); }
.preview-btn { margin-top:10px; font-size:0.75em; padding:4px 10px; background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); box-shadow:none; z-index:5; position:relative; pointer-events: auto !important; cursor: pointer !important;}
.preview-btn:hover { background:rgba(255,255,255,0.2); }

/* FATE CARDS */
.fate-grid { display:grid; grid-template-columns:repeat(5,1fr); gap:8px; margin:20px auto; max-width:500px; perspective:1000px; }
.fate-card { width:100%; aspect-ratio:2/3; position:relative; cursor:pointer; background:none; border:none; padding:0; transform-style:preserve-3d; transition:transform 0.6s; }
.fate-card .inner { position:absolute; inset:0; border-radius:8px; transform-style:preserve-3d; transition:transform 0.6s; box-shadow:0 5px 15px rgba(0,0,0,0.5); }
.fate-card.flipped .inner { transform:rotateY(180deg); }
.fate-card .front, .fate-card .back { position:absolute; inset:0; backface-visibility:hidden; border-radius:8px; display:flex; align-items:center; justify-content:center; border:1px solid rgba(255,215,0,0.3); flex-direction: column; padding: 5px; box-sizing: border-box; }
.fate-card .front { background:#111; z-index:2; } 
.fate-card .back { background:#2a0033; transform:rotateY(180deg); z-index:1; }
.fate-card h3 { font-size: 0.8em; margin-bottom: 5px; text-transform: uppercase; color: var(--gold); }
.fate-card p { font-size: 0.6em; line-height: 1.2; opacity: 0.9; }
.fate-card.poof { animation: smokePoof 0.6s forwards; }
@keyframes smokePoof { 0%{ opacity:1; transform:scale(1); } 100%{ opacity:0; transform:scale(0.5); } }
@media (max-width:700px) { .fate-grid { grid-template-columns:repeat(3,1fr); } .fate-card:nth-child(4), .fate-card:nth-child(5) { grid-column:span 1; } }

/* INTENSITY BUTTONS */
.intensity-wrap { margin: 10px 0; }
.intensity-btn { margin: 5px; opacity: 0.6; }
.intensity-btn.active { opacity: 1; border: 2px solid var(--gold); box-shadow: 0 0 15px var(--hot); }
.intensity-mini { display:flex; gap:5px; justify-content:center; margin: 15px 0; }
.intensity-mini button { padding: 5px 15px; font-size: 0.8em; opacity: 0.6; }
.intensity-mini button.active { opacity: 1; border: 1px solid var(--gold); }
.intensity-btn { position: relative; transition: all 0.3s; }

/* SAFETY & CONSENT UI */
.consent-controls { display: flex; flex-direction: column; align-items: flex-start; gap: 10px; margin: 15px auto; width: 95%; max-width: 600px; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-sizing: border-box; }
.consent-controls label { display: flex; align-items: center; gap: 10px; cursor: pointer; color: var(--ink); font-size: 0.9em; }
.boundary-chips { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; width: 95%; justify-content: center; }
.chip { padding: 5px 12px; background: #333; border: 1px solid #555; border-radius: 20px; font-size: 0.8em; cursor: pointer; transition: 0.2s; opacity: 0.6; }
.chip.active { background: var(--pink); border-color: var(--hot); color: black; opacity: 1; font-weight: bold; }
.chip.locked-chip { cursor: not-allowed; opacity: 0.8; border-color: var(--gold); color: var(--gold); }
.toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #333; border: 1px solid var(--gold); color: var(--gold); padding: 10px 20px; border-radius: 30px; z-index: 10002; animation: fadeInOut 3s forwards; }
@keyframes fadeInOut { 0%{opacity:0; transform:translate(-50%, 20px);} 10%{opacity:1; transform:translate(-50%, 0);} 90%{opacity:1;} 100%{opacity:0;} }

/* EROTIC PREVIEW TEXT */
#eroticPreviewText { 
    font-family: var(--font-story); font-size: 1.1em; line-height: 1.6; 
    color: var(--p2-color); font-style: italic; border-left: 3px solid var(--pink); 
    padding-left: 15px; margin: 20px 0; text-align: left;
}

/* LOADING BAR */
#loadingOverlayInner { background: rgba(10, 0, 30, 0.95); padding: 18px 26px 14px 26px; border-radius: 14px; box-shadow: 0 0 35px rgba(255, 20, 147, 0.8); min-width: 280px; text-align: left; font-size: 0.95em; }
#loadingOverlayBar { width: 100%; height: 6px; background: rgba(255, 255, 255, 0.12); border-radius: 999px; overflow: hidden; margin-top: 8px; }
#loadingOverlayFill { width: 0%; height: 100%; background: var(--pink); transition: width 0.25s; }

/* BURGER */
#burgerBtn { position:fixed; top:15px; right:15px; z-index:5000; font-size:1.8em; background:none; border:none; color:var(--pink); padding:0; cursor:pointer; text-shadow: 0 0 5px var(--hot); box-shadow:none; }
#burgerBtn:hover { transform: scale(1.1); box-shadow:none; }

/* VISUALIZE MODAL */
.viz-modal-content { text-align: center; max-width: 600px; width: 90%; max-height:90vh; overflow-y:auto; }
.viz-controls { display:flex; gap:10px; justify-content:center; margin-top:15px; flex-wrap:wrap; }
#vizPreviewImg { width: 100%; border-radius: 8px; margin-top: 10px; max-height: 400px; object-fit: contain; background:#000; min-height:200px; display:none; }
#vizPlaceholder { width: 100%; height:200px; display:flex; align-items:center; justify-content:center; border:1px dashed #444; margin-top:10px; color:#666; font-style:italic;}
#vizPromptInput { width: 100%; height: 60px; font-size: 0.85em; margin-bottom: 10px; color: var(--gold); border: 1px solid var(--pink); background: rgba(0,0,0,0.5); }

/* SETTING SHOT */
#settingShotWrap { 
    margin-bottom: 30px; animation: fadeIn 2s ease; border-radius: 12px; overflow: hidden; 
    border: 1px solid var(--pink); box-shadow: 0 0 20px rgba(255,20,147,0.3); 
    position:relative; min-height:250px; background: rgba(0,0,0,0.3);
    display: flex; align-items: center; justify-content: center;
}
#settingShotImg { width: 100%; display: none; }
.img-error-msg { font-size:0.9em; color:#ff6b6b; padding:20px; font-style: italic; z-index:5; text-align:center; }

/* META UI */
#metaControls .meta-stance { opacity: 0.5; border: 1px solid transparent; }
#metaControls .meta-stance.active { opacity: 1; border: 1px solid var(--gold); box-shadow: 0 0 5px var(--gold); }

/* COUPLE UI */
#coupleRoomCodeWrap { display: flex; align-items: center; justify-content: center; gap: 10px; }
#btnCopyCode { background: none; border: 1px solid var(--pink); padding: 5px; border-radius: 5px; cursor: pointer; color: var(--gold); }

/* GOD MODE UI */
#godModeToggle { margin-top:10px; font-size:0.8em; display:flex; align-items:center; justify-content:center; gap:8px; opacity:0.8; cursor:pointer; }
#godModeToggle input { width:auto; margin:0; cursor:pointer; }
#godModeLabel { color: var(--gold); font-family:var(--font-main); letter-spacing:1px; }
.quill-ui { display:flex; flex-direction:column; align-items:center; margin-top:5px; font-size:0.8em; color:var(--gold); }

/* AUTH PANEL */
#auth-panel { position:fixed; top:10px; right:60px; z-index:2000; background:rgba(0,0,0,0.9); padding:10px; border:1px solid #444; border-radius:5px; display:flex; flex-direction:column; gap:5px; }
#auth-panel input { padding:5px; width: 150px; font-size: 0.8em; }
#auth-status { font-size:12px; margin-top:6px; color:#fff; }

@keyframes fadeIn { from{opacity:0;} to{opacity:1;} }
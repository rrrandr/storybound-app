/* GLOBAL VARS */
:root { 
    --bg1: #0a001f; --bg2: #2a0033; --pink: #ff69b4; --hot: #ff1493; --gold: #ffd700; --ink: #f0e6ff; --panel: rgba(20,0,40,.6); 
    --btn-bg: linear-gradient(145deg, #8b008b, var(--hot)); --btn-txt: var(--gold);
    --p1-color: #B0E0E6; --p2-color: #FFB6C1;
    --font-main: 'Lora', serif; 
    --font-story: 'Lora', serif;
    --story-size: 1.15em;
    --line-height: 1.8; 
    --letter-spacing: 0.02em;
    --cursor-url: url('cursor-dollar-plane-64.png');
}

/* ═══════════════════════════════════════════════════════════════════
   READING STYLES - SCOPED TO BOOK INTERIOR ONLY
   App UI, cover, and environment are NEVER affected by reading style
   ═══════════════════════════════════════════════════════════════════ */

/* Book Interior Variables (default: Print/Easy - light page) */
:root {
    --page-bg: #faf8f3;
    --page-text: #1a1a1a;
    --page-accent: #444;
}

/* Paper Style: Print (default) - clean white page */
.story-content.paper-print,
.story-content {
    --page-bg: #faf8f3;
    --page-text: #1a1a1a;
    --page-accent: #333;
}

/* Paper Style: Cream - warm easy reading */
.story-content.paper-cream {
    --page-bg: #fffdd0;
    --page-text: #1a1a1a;
    --page-accent: #555;
}

/* Paper Style: Sepia - vintage book feel */
.story-content.paper-sepia {
    --page-bg: #f5e6c8;
    --page-text: #3d2817;
    --page-accent: #5c4033;
}

/* Paper Style: Warm Paper (Night Mode safe) */
.story-content.paper-warm {
    --page-bg: #2c2418;
    --page-text: #d4c8b0;
    --page-accent: #a08060;
}

/* Paper Style: Dark Page (Night Mode safe) */
.story-content.paper-dark {
    --page-bg: #1e1e1e;
    --page-text: #e0e0e0;
    --page-accent: #888;
}

/* Apply paper styles to story text container */
#storyText, .story-pages-container {
    background: var(--page-bg);
    color: var(--page-text);
    border-radius: 4px;
    padding: 20px 30px;
    margin: 10px 0;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
}

/* LEGACY THEME SUPPORT (for gradual migration) */
/* These still work but are discouraged - prefer paper-* classes */
body.theme-sepia { --bg1:#2c2218; --bg2:#3e2f22; --pink:#d2b48c; --hot:#8b4513; --gold:#ffa500; --ink:#f5deb3; --panel:rgba(40,30,20,0.8); --btn-bg:#5c4033; --btn-txt:#f5deb3; }
body.theme-midnight { --bg1:#000000; --bg2:#111111; --pink:#444; --hot:#666; --gold:#888; --ink:#ccc; --panel:rgba(20,20,20,0.9); --btn-bg:#333; --btn-txt:#aaa; }
body.theme-print { --bg1:#e0e0e0; --bg2:#f0f0f0; --pink:#333; --hot:#000; --gold:#444; --ink:#111; --panel:rgba(255,255,255,0.95); --btn-bg:#ccc; --btn-txt:#000; }
body.theme-easy { --bg1:#fffdd0; --bg2:#fff8c0; --pink:#333; --hot:#000; --gold:#555; --ink:#000; --panel:rgba(255,255,240,0.95); --btn-bg:#000; --btn-txt:#fff; }

/* Print Fixes */
body.theme-print .fate-card h3, body.theme-easy .fate-card h3 { color: #000 !important; text-shadow: none !important; font-weight: bold; }
body.theme-print .section-title, body.theme-easy .section-title { text-shadow: none; color: var(--hot); }

html, body { margin:0; padding:0; background:linear-gradient(135deg,var(--bg1),var(--bg2)); color:var(--ink); font-family:var(--font-main); overflow-x:hidden; min-height:100vh; }
body { text-align:center; padding:10px; transition: background 0.3s, color 0.3s; }

/* ═══════════════════════════════════════════════════════════════════
   NIGHT MODE - Dims app environment only
   Book cover and book object remain unchanged
   ═══════════════════════════════════════════════════════════════════ */

body.night-mode {
    --bg1: #151515;
    --bg2: #1a1a1a;
    --pink: #8a5a6a;
    --hot: #7a4a5a;
    --gold: #a08050;
    --ink: #b0a090;
    --panel: rgba(20, 20, 20, 0.9);
}

/* Night Mode: Subdued UI controls */
body.night-mode button:not(.story-content button) {
    filter: brightness(0.8);
}

body.night-mode .nav-btn,
body.night-mode .settings-btn {
    opacity: 0.7;
}

/* Night Mode: Book object remains untouched */
body.night-mode .book-object,
body.night-mode .book-cover,
body.night-mode .book-cover-image {
    filter: none !important;
}

/* Night Mode: Story content uses selected paper style (unchanged) */
body.night-mode #storyText,
body.night-mode .story-pages-container {
    /* Paper style is controlled by paper-* class, not night mode */
}

/* UTILITY CLASSES */
.hidden { display:none !important; }
.overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 3000; display: flex; align-items: center; justify-content: center; flex-direction: column; }

/* TYPOGRAPHY */
h1, h2, .section-title { font-family:'lust-script-display','lust-script',serif !important; color:var(--pink); text-shadow:0 0 15px var(--hot); font-weight:400; }
.section-title { font-size:2.2em; margin:35px 0 15px; border-top:1px solid rgba(255,105,180,0.2); padding-top:20px; }
.instruction-text { font-family: 'Lora', serif; font-size: 0.65em; color: var(--ink); opacity: 0.7; vertical-align: middle; margin-left: 8px; letter-spacing: 0; text-shadow: none; font-weight: normal; display:inline-block; }
.subtitle { font-size: 1.2em; color: var(--gold); font-style: italic; opacity: 0.9; margin-bottom: 30px; }

/* LAYOUT GRID */
.grid-2-col { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; width: 95%; margin: 20px auto 0; }
@media (max-width: 600px) { .grid-2-col { grid-template-columns: 1fr; } }

/* Setup container - override inline max-width to match Quill/Veto horizontal span */
#setup {
    max-width: none !important;
    width: 95%;
}

/* STORY READING EXPERIENCE */
#storyText {
    text-align: left;
    max-width: 100%;
    min-height: 300px;
    margin-bottom: 20px;
    font-size: var(--story-size);
    line-height: var(--line-height);
    letter-spacing: var(--letter-spacing);
    font-family: var(--font-story);
    position: relative;
    overflow: hidden;
}
#storyText p { margin-bottom: 1.5em; }

/* PAGINATED STORY PAGES */
.story-pages-container {
    position: relative;
    width: 100%;
    min-height: 300px;
}

.story-page {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    opacity: 0;
    visibility: hidden;
    transform: translateX(30px);
    transition: none;
    padding: 10px 5px;
    box-sizing: border-box;
    background: transparent;
    border-radius: 8px;
    box-shadow: inset 0 0 30px rgba(0,0,0,0.1);
}

.story-page.active {
    position: relative;
    opacity: 1;
    visibility: visible;
    transform: translateX(0);
    z-index: 2;
}

.story-page.page-prev {
    transform: translateX(-30px);
    z-index: 1;
}

.story-page.page-next {
    transform: translateX(30px);
    z-index: 1;
}

/* Page Turn Animation - Forward */
.story-page.turning-out {
    animation: pageTurnOut 500ms ease-in-out forwards;
}

.story-page.turning-in {
    animation: pageTurnIn 500ms ease-in-out forwards;
}

/* Page Turn Animation - Backward */
.story-page.turning-out-reverse {
    animation: pageTurnOutReverse 500ms ease-in-out forwards;
}

.story-page.turning-in-reverse {
    animation: pageTurnInReverse 500ms ease-in-out forwards;
}

@keyframes pageTurnOut {
    0% {
        opacity: 1;
        transform: translateX(0) rotateY(0deg);
        transform-origin: left center;
    }
    50% {
        box-shadow: -5px 0 20px rgba(0,0,0,0.3);
    }
    100% {
        opacity: 0;
        transform: translateX(-50px) rotateY(-5deg);
        transform-origin: left center;
    }
}

@keyframes pageTurnIn {
    0% {
        opacity: 0;
        transform: translateX(50px) rotateY(5deg);
        transform-origin: right center;
        visibility: visible;
    }
    50% {
        box-shadow: 5px 0 20px rgba(0,0,0,0.2);
    }
    100% {
        opacity: 1;
        transform: translateX(0) rotateY(0deg);
        transform-origin: right center;
    }
}

@keyframes pageTurnOutReverse {
    0% {
        opacity: 1;
        transform: translateX(0) rotateY(0deg);
        transform-origin: right center;
    }
    50% {
        box-shadow: 5px 0 20px rgba(0,0,0,0.3);
    }
    100% {
        opacity: 0;
        transform: translateX(50px) rotateY(5deg);
        transform-origin: right center;
    }
}

@keyframes pageTurnInReverse {
    0% {
        opacity: 0;
        transform: translateX(-50px) rotateY(-5deg);
        transform-origin: left center;
        visibility: visible;
    }
    50% {
        box-shadow: -5px 0 20px rgba(0,0,0,0.2);
    }
    100% {
        opacity: 1;
        transform: translateX(0) rotateY(0deg);
        transform-origin: left center;
    }
}

/* Page Navigation Controls */
.page-nav-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin: 15px 0;
    padding: 10px;
}

.page-nav-btn {
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,215,0,0.3);
    color: var(--gold);
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.9em;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
}

.page-nav-btn:hover:not(:disabled) {
    background: rgba(255,215,0,0.15);
    border-color: var(--gold);
    transform: scale(1.02);
}

.page-nav-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
    transform: none;
}

.page-indicator {
    font-size: 0.85em;
    color: var(--ink);
    opacity: 0.7;
    font-family: var(--font-main);
    min-width: 80px;
    text-align: center;
}

/* Reduced Motion - Accessibility */
@media (prefers-reduced-motion: reduce) {
    .story-page,
    .story-page.turning-out,
    .story-page.turning-in,
    .story-page.turning-out-reverse,
    .story-page.turning-in-reverse {
        animation: none !important;
        transition: opacity 0.2s ease !important;
    }

    .story-page.turning-out,
    .story-page.turning-out-reverse {
        opacity: 0;
    }

    .story-page.turning-in,
    .story-page.turning-in-reverse {
        opacity: 1;
        transform: translateX(0);
        visibility: visible;
    }
}

.story-image {
    max-width: 100%;
    border-radius: 10px;
    margin: 14px 0;
    border: 1px solid rgba(255,105,180,0.25);
    box-shadow: 0 0 18px rgba(0,0,0,0.35);
}

/* DECISION SNAPSHOTS */
.decision-snapshot {
    text-align: center;
    color: var(--gold);
    font-style: italic;
    border-top: 1px solid var(--pink);
    border-bottom: 1px solid var(--pink);
    padding: 15px 10px;
    margin: 25px 0;
    background: rgba(0,0,0,0.3);
    font-family: 'lust-script-display', serif;
    font-size: 1.2em;
    line-height: 1.4;
}
.decision-snapshot span {
    display: block;
    font-family: var(--font-main);
    font-size: 0.6em;
    text-transform: uppercase;
    letter-spacing: 2px;
    opacity: 0.7;
    margin-bottom: 5px;
    color: var(--ink);
}

/* DIALOGUE */
.dialogue-block { display: block; margin: 15px 0; padding-left: 20px; border-left: 3px solid rgba(255,255,255,0.2); font-style: italic; font-weight: 500; font-size: 1.1em; }
.p1-dia { color: var(--p1-color); border-color: var(--p1-color); }
.p2-dia { color: var(--p2-color); border-color: var(--p2-color); }

/* STORY DIALOGUE FORMATTING */
#storyText .story-dialogue { font-style: italic; font-size: 1.15em; color: var(--pink); display: inline; }
#storyText .dialogue-tag { font-style: italic; font-size: 1.15em; color: var(--pink); display: inline; }

body.lgbtq-mode .p1-dia { color: #bf55ec !important; border-color: #bf55ec !important; }
body.lgbtq-mode .p2-dia { color: #ffae00 !important; border-color: #ffae00 !important; }

/* BUTTONS */
button { background:var(--btn-bg); color:var(--btn-txt); padding:10px 30px; border:none; border-radius:25px; font-size:1em; cursor:pointer; box-shadow:0 0 18px rgba(0,0,0,0.2); transition:.3s; font-family:var(--font-main); position:relative; }
button:hover { transform:scale(1.05); filter:brightness(1.2); }
button:disabled { opacity:0.5; cursor:not-allowed; transform:none; }
.small-btn { font-size: 0.9em; padding: 8px 16px; background: #444; color:#fff; box-shadow:none; }

/* STORY WORLD SECTION */
.world-section { margin: 15px 0; }
.world-toggle { margin-bottom: 10px; transition: all 0.3s ease; }
.world-toggle.active { background: var(--pink); color: #000; }

/* UTILS */
.box { max-width:600px; margin:20px auto; padding:25px; background:var(--panel); border:1px solid var(--pink); border-radius:15px; box-shadow:0 0 20px rgba(0,0,0,0.2); }

/* CHOICE BUTTONS - Responsive Stack */
.choice-buttons { 
    display:flex; 
    flex-wrap:wrap; 
    gap:20px; 
    justify-content:center; 
    margin:30px auto; 
    max-width:800px; 
}
.choice-buttons > div {
    flex: 1 1 200px;
    max-width: 300px;
    display: flex;
    flex-direction: column;
    align-items: center;
}
@media (max-width: 640px) {
    .choice-buttons { flex-direction: column; align-items: center; width: 100%; }
    .choice-buttons > div { width: 100%; max-width: 100%; flex: 1 1 100%; }
    .choice { width: 100%; margin: 0 auto; }
}

.choice { padding:15px 40px; font-size:1.4em; border-radius:30px; font-family:'lust-script-display',serif; width: 100%; box-sizing: border-box; }
.choice-desc { opacity:0.7; max-width:250px; margin:10px auto; }

/* INPUTS & LOCKS */
.input-wrapper { position: relative; width: 95%; margin: 0 auto 15px; overflow:hidden; }
.input-wrapper label, .setting-label { display:block; text-align:center; color:var(--gold); margin-bottom:5px; font-size:0.9em; font-family:var(--font-main); text-transform:uppercase; letter-spacing:1px; }
textarea, input, select { width:100%; padding:15px; background:rgba(0,0,0,0.3); color:var(--ink); border:1px solid var(--pink); border-radius:8px; font-size:1em; font-family:var(--font-main); box-sizing:border-box; }

/* GHOST TEXT / PILL GRID */
.ghost-overlay {
    position: absolute; top: 0; left: 0; right: 0; bottom: 0;
    pointer-events: none; overflow: hidden; padding: 10px;
    background: rgba(0,0,0,0.2);
}
.ghost-grid {
    display: flex; flex-wrap: wrap; align-content: flex-start; gap: 6px;
    height: 100%; width: 100%;
}

/* LOCKS & CURSOR */
.locked-input, .locked-input textarea, .locked-style, .card.locked, .fate-card.locked, .intensity-btn.locked,
.intensity-btn.locked-tease, .intensity-btn.locked-pass, [data-locked] {
    opacity:0.6; filter:grayscale(0.9);
    cursor: url('/cursor-dollar-plane-64.png'), pointer !important;
    pointer-events: auto !important;
}
.locked-input, .locked-style, .card.locked, .fate-card.locked, .intensity-btn.locked,
.intensity-btn.locked-tease, .intensity-btn.locked-pass, [data-locked] {
    position: relative;
}
.locked-style { display: inline-block; }

/* HANDCUFF OVERLAY - SVG (applies to all locked elements) */
.locked-input::after, .locked-style::after, .card.locked::after, .fate-card.locked::after,
.intensity-btn.locked::after, .intensity-btn.locked-tease::after, .intensity-btn.locked-pass::after,
[data-locked]::after {
    content:""; position:absolute;
    top:5px; right:5px;
    width:24px; height:24px;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M17.5 13.5a3.5 3.5 0 1 0-2.5-5.9l-1.5 1.5'%3E%3C/path%3E%3Cpath d='M6.5 10.5a3.5 3.5 0 1 0 2.5 5.9l1.5-1.5'%3E%3C/path%3E%3Cpath d='M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0-2 0'%3E%3C/path%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: center;
    background-size: contain;
    opacity:0.9;
    pointer-events:none;
    z-index: 10;
    filter: drop-shadow(0 0 2px black);
}
.locked-input::after { top: 40px; right: 10px; }
.intensity-btn.locked-tease::after, .intensity-btn.locked-pass::after { top: 2px; right: 2px; transform: none; width: 16px; height: 16px; } 

/* STYLE CARDS - Grid layout with centered rows */
.style-cards {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin: 15px 0;
    justify-content: center;
}

.card {
    background: #252525;
    border-radius: 12px;
    padding: 15px;
    cursor: pointer;
    text-align: left;
    border: 2px solid transparent;
    position: relative;
    transition: transform 0.2s, border-color 0.2s, box-shadow 0.2s;
    width: 200px;
    flex-shrink: 0;
}
.card:hover { transform: translateY(-3px); border-color: #ff6b6b; }
.card.selected { border-color: #ff69b4; background: #333; box-shadow: 0 0 15px rgba(255,105,180,0.3); }

/* Responsive */
@media (max-width: 700px) {
    .style-cards { gap: 12px; }
    .card { width: 180px; }
}
@media (max-width: 500px) {
    .card { width: 90%; max-width: 280px; }
}

/* Layer gating states */
.card.layer-locked {
    opacity: 0.35;
    cursor: not-allowed;
    pointer-events: none;
    filter: grayscale(0.5);
}
.card.incompatible {
    opacity: 0.4;
    cursor: not-allowed;
    pointer-events: none;
    border-color: rgba(100, 100, 100, 0.3);
}
.card.auto-cleared {
    animation: autoClearFade 1.5s ease-out forwards;
}
@keyframes autoClearFade {
    0% { opacity: 1; border-color: #ff6b6b; }
    30% { opacity: 0.6; border-color: #666; }
    100% { opacity: 1; border-color: var(--gold); }
}
.layer-helper {
    font-size: 0.7em;
    color: var(--ink);
    opacity: 0.6;
    font-style: italic;
    font-family: var(--font-main);
}

/* =================================
   5×7 SELECTION FLIP CARDS
   Grid layout with centered rows
   ================================= */
.selection-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    justify-content: center;
    margin: 15px 0;
    position: relative;
}

/* Responsive */
@media (max-width: 500px) {
    .selection-grid { gap: 10px; }
}

.selection-card {
    width: 85px;
    height: 119px; /* 5:7 ratio */
    perspective: 1000px;
    cursor: pointer;
    position: relative;
    flex-shrink: 0;
}

.selection-card-inner {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.4s ease;
}

.selection-card.flipped .selection-card-inner {
    transform: rotateY(180deg);
}

.selection-card-face {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 8px;
    overflow: hidden;
}

.selection-card-front {
    background: linear-gradient(145deg, #2a2a2a 0%, #1a1a1a 100%);
    border: 1px solid var(--gold);
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 8px;
}

.selection-card-front .card-title {
    font-family: 'lust-script-display', serif;
    font-size: 11px;
    color: var(--gold);
    line-height: 1.2;
    word-wrap: break-word;
}

.selection-card-back {
    background: linear-gradient(145deg, #1a1a1a 0%, #0d0d0d 100%);
    border: 1px solid var(--pink);
    transform: rotateY(180deg);
    padding: 10px;
    overflow-y: auto;
}

.selection-card-back .card-title {
    font-family: 'lust-script-display', serif;
    font-size: 12px;
    color: var(--pink);
    margin: 0 0 6px;
    text-align: center;
}

.selection-card-back .card-desc {
    font-size: 9px;
    color: var(--ink);
    line-height: 1.3;
    margin: 0 0 8px;
    text-align: center;
}

.selection-card-back .sub-options {
    display: flex;
    flex-direction: column;
    gap: 4px;
    margin-top: 6px;
}

.selection-card-back .sub-option {
    padding: 4px 6px;
    font-size: 8px;
    color: var(--ink);
    background: rgba(201, 162, 39, 0.1);
    border: 1px solid transparent;
    border-radius: 3px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
}

.selection-card-back .sub-option:hover {
    color: var(--gold);
    border-color: var(--gold);
    background: rgba(201, 162, 39, 0.2);
}

.selection-card-back .sub-option.selected {
    color: var(--pink);
    border-color: var(--pink);
    background: rgba(255, 105, 180, 0.15);
}

/* Card states */
.selection-card.selected .selection-card-front {
    border-color: var(--pink);
    box-shadow: 0 0 10px rgba(255, 105, 180, 0.4);
}

.selection-card.selected .selection-card-front .card-title {
    color: var(--pink);
}

.selection-card.dimmed {
    opacity: 0.3;
    pointer-events: none;
}

.selection-card.layer-locked {
    opacity: 0.25;
    pointer-events: none;
    filter: grayscale(0.6);
}

.selection-card.incompatible {
    opacity: 0.3;
    pointer-events: none;
}

/* Selection card in-place zoom state */
.selection-card.zoomed {
    position: relative;
    z-index: 1000;
    transition: transform 0.3s ease;
    pointer-events: auto !important;
    opacity: 1 !important;
}

.selection-card.zoomed .selection-card-front {
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6),
                0 0 30px rgba(255, 105, 180, 0.3);
}

.card h3 { margin:0 0 5px; color:#ff6b6b; font-size:1.1em; font-family:'lust-script-display',serif; }
.card p { font-size:0.9em; opacity:0.9; margin:0; font-family:var(--font-main); }
.preview-btn { margin-top:10px; font-size:0.75em; padding:4px 10px; background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); box-shadow:none; z-index:15; position:relative; pointer-events: auto !important; cursor: pointer !important;}
.preview-btn:hover { background:rgba(255,255,255,0.2); }

/* FATE CARDS - Grid layout with centered rows */
.fate-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin: 20px auto;
    max-width: 650px;
    justify-content: center;
    perspective: 1000px;
}

.fate-card {
    width: 100px;
    aspect-ratio: 5/7;
    position: relative;
    cursor: pointer;
    background: none;
    border: none;
    padding: 0;
    transform-style: preserve-3d;
    transition: transform 0.6s;
}
.fate-card .inner { position:absolute; inset:0; border-radius:8px; transform-style:preserve-3d; transition:transform 0.6s; box-shadow:0 5px 15px rgba(0,0,0,0.5); }
.fate-card.flipped .inner { transform:rotateY(180deg); }
.fate-card .front, .fate-card .back { position:absolute; inset:0; backface-visibility:hidden; border-radius:8px; display:flex; align-items:center; justify-content:center; border:1px solid rgba(255,215,0,0.3); flex-direction: column; padding: 5px; box-sizing: border-box; }
.fate-card .front {
    background: url('destiny-tree.png') center/cover no-repeat, #111;
    z-index:2;
}
.fate-card .front h3 { display: none; } /* Hide text, image has DESTINY label */
.fate-card .back { background:#2a0033; transform:rotateY(180deg); z-index:1; }
.fate-card h3 { font-size: 0.8em; margin-bottom: 5px; text-transform: uppercase; color: var(--gold); }
.fate-card p { font-size: 0.6em; line-height: 1.2; opacity: 0.9; }
.fate-card.poof { animation: smokePoof 0.6s forwards; }
@keyframes smokePoof { 0%{ opacity:1; transform:scale(1); } 100%{ opacity:0; transform:scale(0.5); } }
.fate-card.selected .inner { border: 2px solid var(--gold); box-shadow: 0 0 15px var(--gold); }
.fate-card.chosen .inner { border: 2px solid var(--pink); }

/* Responsive */
@media (max-width: 700px) {
    .fate-grid { gap: 10px; max-width: 400px; }
    .fate-card { width: 85px; }
}
@media (max-width: 500px) {
    .fate-grid { gap: 8px; max-width: 320px; }
    .fate-card { width: 75px; }
}

/* GOLDEN FLOW - continuous gentle stream from Fate Card to inputs */
.golden-flow-container {
    position: fixed;
    pointer-events: none;
    z-index: 9999;
}
.golden-flow-particle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: var(--gold);
    border-radius: 50%;
    box-shadow: 0 0 6px var(--gold), 0 0 10px rgba(255,215,0,0.5);
    opacity: 0;
}

/* FATE CARD SEPARATOR IN STORY */
.fate-card-separator { display: flex; justify-content: center; margin: 25px auto; padding: 15px 0; border-top: 1px solid rgba(255,215,0,0.3); border-bottom: 1px solid rgba(255,215,0,0.3); background: rgba(0,0,0,0.2); }
.fate-card-separator .fate-mini { width: 60px; aspect-ratio: 5/7; background: linear-gradient(145deg, #2a0033, #400020); border: 1px solid var(--gold); border-radius: 6px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 5px; box-shadow: 0 0 10px rgba(255,215,0,0.3); }
.fate-card-separator .fate-mini h4 { font-size: 0.6em; color: var(--gold); margin: 0 0 3px; text-transform: uppercase; }

/* INTENSITY BUTTONS */
.intensity-wrap { margin: 10px 0; }
.intensity-btn { margin: 5px; opacity: 0.6; }
.intensity-btn.active { opacity: 1; border: 2px solid var(--gold); box-shadow: 0 0 15px var(--hot); }
.intensity-mini { display:flex; gap:5px; justify-content:center; margin: 15px 0; }
.intensity-mini button { padding: 5px 15px; font-size: 0.8em; opacity: 0.6; }
.intensity-mini button.active { opacity: 1; border: 1px solid var(--gold); }
.intensity-btn { position: relative; transition: all 0.3s; }

/* SAFETY & CONSENT UI */
.consent-controls { display: flex; flex-direction: column; align-items: flex-start; gap: 10px; margin: 15px auto; width: 95%; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); box-sizing: border-box; }
.consent-controls.horizontal { flex-direction: row; justify-content: center; align-items: center; flex-wrap: wrap; }
.consent-controls label { display: flex; align-items: center; gap: 10px; cursor: pointer; color: var(--ink); font-size: 0.9em; }
.boundary-chips { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; width: 95%; justify-content: center; }
.chip { padding: 5px 12px; background: #333; border: 1px solid #555; border-radius: 20px; font-size: 0.8em; cursor: pointer; transition: 0.2s; opacity: 0.6; }
.chip:hover { opacity: 0.9; border-color: var(--pink); }
.chip.active { background: var(--pink); border-color: var(--hot); color: black; opacity: 1; font-weight: bold; }
.chip.locked-chip { cursor: not-allowed; opacity: 0.8; border-color: var(--gold); color: var(--gold); }
.chip.locked-chip:hover { border-color: var(--gold); }
/* CORRECTIVE: Toast positioned between Veto/Quill panels, not overlapping Begin Story */
.toast { position: fixed; top: 40%; left: 50%; transform: translate(-50%, -50%); background: #333; border: 1px solid var(--gold); color: var(--gold); padding: 12px 24px; border-radius: 30px; z-index: 10006; animation: toastFadeInOut 3s forwards; font-size: 1em; }
@keyframes toastFadeInOut { 0%{opacity:0; transform:translate(-50%, calc(-50% + 20px));} 10%{opacity:1; transform:translate(-50%, -50%);} 90%{opacity:1;} 100%{opacity:0;} }

/* EROTIC PREVIEW TEXT */
#eroticPreviewText { 
    font-family: var(--font-story); font-size: 1.1em; line-height: 1.6; 
    color: var(--p2-color); font-style: italic; border-left: 3px solid var(--pink); 
    padding-left: 15px; margin: 20px 0; text-align: left;
}

/* LOADING BAR */
#loadingOverlayInner { background: rgba(10, 0, 30, 0.95); padding: 18px 26px 14px 26px; border-radius: 14px; box-shadow: 0 0 35px rgba(255, 20, 147, 0.8); min-width: 280px; text-align: left; font-size: 0.95em; position: relative; }
#loadingOverlayBar { width: 100%; height: 6px; background: rgba(255, 255, 255, 0.12); border-radius: 999px; overflow: hidden; margin-top: 8px; }
#loadingOverlayFill { width: 0%; height: 100%; background: var(--pink); transition: width 0.25s; }
#loadingPercent { font-size: 0.8em; color: rgba(255,255,255,0.7); margin-top: 4px; text-align: right; }
.loading-cancel-btn { position: absolute; top: 5px; right: 8px; background: none; border: none; color: rgba(255,255,255,0.6); font-size: 1.4em; cursor: pointer; padding: 0; line-height: 1; display: none; }
.loading-cancel-btn:hover { color: var(--pink); }
.loading-cancel-btn.visible { display: block; }

/* BURGER */
#burgerBtn { position:fixed; top:15px; right:15px; z-index:5000; font-size:1.8em; background:none; border:none; color:var(--pink); padding:0; cursor:pointer; text-shadow: 0 0 5px var(--hot); box-shadow:none; }
#burgerBtn:hover { transform: scale(1.1); box-shadow:none; }

/* VISUALIZE MODAL */
.viz-modal-content { text-align: center; max-width: 650px; width: 95%; max-height:95vh; overflow-y:auto; }
.viz-controls { display:flex; gap:10px; justify-content:center; margin-top:15px; flex-wrap:wrap; }
#vizPreviewImg { width: 100%; border-radius: 8px; margin-top: 10px; max-height: 400px; object-fit: contain; background:#000; min-height:200px; display:none; }
#vizPlaceholder { width: 100%; height:200px; display:flex; align-items:center; justify-content:center; border:1px dashed #444; margin-top:10px; color:#666; font-style:italic;}
/* Increased height for better prompt visibility */
#vizPromptInput { width: 100%; height: 100px; font-size: 0.9em; margin-bottom: 8px; color: var(--gold); border: 1px solid var(--pink); background: rgba(0,0,0,0.5); resize: vertical; }

/* Visualize Modifier Pills */
#vizModifierSection { margin-bottom: 12px; }
.viz-modifier-pills {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    justify-content: center;
    max-height: 80px;
    overflow-y: auto;
    padding: 8px;
    background: rgba(0,0,0,0.3);
    border-radius: 8px;
    margin-bottom: 8px;
}
.viz-pill {
    background: rgba(255,105,180,0.15);
    border: 1px solid rgba(255,105,180,0.4);
    color: var(--ink);
    padding: 4px 10px;
    border-radius: 15px;
    font-size: 0.75em;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
}
.viz-pill:hover {
    background: rgba(255,105,180,0.35);
    border-color: var(--pink);
    transform: scale(1.05);
}
.viz-modifier-pills.hidden { display: none; }
#vizModifierInput {
    width: 100%;
    padding: 8px 12px;
    font-size: 0.85em;
    background: rgba(0,0,0,0.4);
    border: 1px solid rgba(255,215,0,0.3);
    border-radius: 6px;
    color: var(--gold);
}
#vizModifierInput::placeholder { color: rgba(255,215,0,0.5); }

/* SETTING SHOT */
#settingShotWrap { 
    margin-bottom: 30px; animation: fadeIn 2s ease; border-radius: 12px; overflow: hidden; 
    border: 1px solid var(--pink); box-shadow: 0 0 20px rgba(255,20,147,0.3); 
    position:relative; min-height:250px; background: rgba(0,0,0,0.3);
    display: flex; align-items: center; justify-content: center;
}
#settingShotImg { width: 100%; display: none; }
.img-error-msg { font-size:0.9em; color:#ff6b6b; padding:20px; font-style: italic; z-index:5; text-align:center; }

/* META UI */
#metaControls .meta-stance { opacity: 0.5; border: 1px solid transparent; }
#metaControls .meta-stance.active { opacity: 1; border: 1px solid var(--gold); box-shadow: 0 0 5px var(--gold); }

/* COUPLE UI */
#coupleRoomCodeWrap { display: flex; align-items: center; justify-content: center; gap: 10px; }
#btnCopyCode { background: none; border: 1px solid var(--pink); padding: 5px; border-radius: 5px; cursor: pointer; color: var(--gold); }

/* GOD MODE UI */
#godModeToggle { margin-top:10px; font-size:0.8em; display:flex; align-items:center; justify-content:center; gap:8px; opacity:0.8; cursor:pointer; }
#godModeToggle input { width:auto; margin:0; cursor:pointer; }
#godModeLabel { color: var(--gold); font-family:var(--font-main); letter-spacing:1px; }
.quill-ui, .quill-veto-ui { display:flex; flex-direction:column; align-items:center; margin-top:5px; font-size:0.8em; color:var(--gold); width:95%; margin-left:auto; margin-right:auto; }
@media (max-width: 600px) {
    .quill-veto-ui > div:first-child { flex-direction: column; gap: 10px !important; }
}

/* QUILL & VETO CONTAINER */
.quill-veto-container { display:grid; grid-template-columns:1fr 1fr; gap:20px; width:95%; margin:15px auto; }
@media (max-width:700px) { .quill-veto-container { grid-template-columns:1fr; } }
.qv-section { background:rgba(0,0,0,0.2); border:1px solid rgba(255,105,180,0.2); border-radius:10px; padding:15px; }
.qv-label { display:block; font-size:1.1em; color:var(--gold); font-family:'lust-script-display',serif; margin-bottom:5px; text-align:center; }
.qv-hint-above { font-size:0.75em; opacity:0.7; margin:0 0 8px; text-align:center; line-height:1.3; }
.qv-hint-below { font-size:0.7em; opacity:0.5; margin:8px 0 0; text-align:center; line-height:1.3; font-style:italic; }
.qv-commit-row { display:flex; align-items:center; gap:10px; margin-top:8px; }
.qv-commit-row.qv-commit-center { justify-content:center; }
.qv-section textarea { width:100%; min-height:50px; resize:vertical; }

/* PILL TRAY - See grid layout at end of file */
.pill:hover { background:rgba(255,105,180,0.2); opacity:1; border-color:var(--pink); }
.pill.veto-pill { border-color:rgba(255,69,69,0.4); }
.pill.veto-pill:hover { border-color:#ff6b6b; background:rgba(255,69,69,0.15); }
.pill.quill-pill { border-color:rgba(255,215,0,0.4); }
.pill.quill-pill:hover { border-color:var(--gold); background:rgba(255,215,0,0.15); }

/* AUTH PANEL */
#auth-panel { position:fixed; top:10px; right:60px; z-index:2000; background:rgba(0,0,0,0.9); padding:10px; border:1px solid #444; border-radius:5px; display:flex; flex-direction:column; gap:5px; }
#auth-panel input { padding:5px; width: 150px; font-size: 0.8em; }
#auth-status { font-size:12px; margin-top:6px; color:#fff; }

/* ARCHETYPE SYSTEM */
.archetype-header-text { font-size: 1.1em; color: var(--ink); opacity: 0.9; margin: 0 0 5px; text-align: center; }
.archetype-subtext { font-size: 0.9em; color: var(--gold); opacity: 0.8; margin: 0 0 20px; text-align: center; font-style: italic; }
.archetype-selection { width: 95%; margin: 0 auto 20px; }
.archetype-group { margin-bottom: 20px; }
.archetype-group-label { display: block; font-size: 0.85em; color: var(--gold); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; text-align: center; }
.archetype-pills { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
.archetype-pill { padding: 8px 16px; background: rgba(255,255,255,0.08); border: 2px solid rgba(255,105,180,0.3); border-radius: 25px; font-size: 0.9em; cursor: pointer; transition: all 0.2s; color: var(--ink); font-family: var(--font-main); }
.archetype-pill:hover { background: rgba(255,105,180,0.15); border-color: var(--pink); transform: translateY(-2px); }
.archetype-pill.selected { background: rgba(255,105,180,0.25); border-color: var(--hot); box-shadow: 0 0 12px rgba(255,20,147,0.4); color: var(--gold); font-weight: 600; }
.archetype-pill.primary-only { border-style: dashed; }
.archetype-pill.primary-only::after { content: " ★"; font-size: 0.7em; opacity: 0.7; }
.archetype-pill.disabled { opacity: 0.4; cursor: not-allowed; pointer-events: none; }
.archetype-constraint-text { font-size: 0.75em; color: var(--ink); opacity: 0.6; margin: 15px 0 0; text-align: center; font-style: italic; }
.archetype-preview { width: 95%; margin: 15px auto; padding: 15px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,105,180,0.2); border-radius: 10px; text-align: left; }
.archetype-preview-name { font-family: 'lust-script-display', serif; font-size: 1.3em; color: var(--pink); margin: 0 0 8px; }
.archetype-preview-summary { font-size: 0.95em; color: var(--ink); line-height: 1.5; margin: 0 0 10px; }
.archetype-preview-shadow { font-size: 0.85em; color: var(--gold); opacity: 0.9; font-style: italic; margin: 0; padding-left: 10px; border-left: 2px solid var(--gold); }
.archetype-preview-modifier { margin-top: 15px; padding-top: 12px; border-top: 1px solid rgba(255,105,180,0.2); }
.archetype-preview-modifier-label { font-size: 0.8em; color: var(--gold); text-transform: uppercase; letter-spacing: 1px; margin: 0 0 5px; }
.archetype-preview-modifier-style { font-size: 0.9em; color: var(--ink); opacity: 0.9; margin: 0; }

/* Selection summary */
.archetype-selection-summary {
    width: 95%;
    margin: 10px auto;
    padding: 12px;
    background: rgba(0,0,0,0.3);
    border: 1px solid rgba(255,105,180,0.2);
    border-radius: 8px;
    display: flex;
    justify-content: center;
    gap: 30px;
    font-size: 0.9em;
}
.archetype-selection-summary p { margin: 0; color: var(--ink); }
.archetype-selection-summary span { color: var(--pink); font-weight: 600; }

@keyframes fadeIn { from{opacity:0;} to{opacity:1;} }

/* ANCESTRY / CULTURE SECTION */
.ancestry-subtext { font-size: 0.9em; color: var(--gold); opacity: 0.8; margin: 0 0 15px; text-align: center; font-style: italic; }
.ancestry-container { width: 95%; margin: 0 auto 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
@media (max-width: 600px) { .ancestry-container { grid-template-columns: 1fr; } }
.ancestry-subsection { background: rgba(255,255,255,0.03); border-radius: 10px; padding: 15px; }
.ancestry-label { font-size: 0.95em; color: var(--pink); font-family: 'lust-script-display', serif; margin-bottom: 12px; text-align: center; }
.ancestry-pills { min-height: 90px; }
@keyframes pillFadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 0.85; transform: scale(1); } }

/* PILL SYSTEM - FIXED WIDTH CLASSES (MANDATORY) */
.pill-tray {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 6px;
    margin-bottom: 8px;
    min-height: 90px;
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
    overflow: hidden; /* Layout safety - prevent pill explosions */
}
@media (max-width: 500px) {
    .pill-tray { grid-template-columns: repeat(3, 1fr); max-width: 380px; }
}
@media (max-width: 380px) {
    .pill-tray { grid-template-columns: repeat(2, 1fr); max-width: 260px; }
}

/* Base pill styles - fixed dimensions, no auto-expansion */
.pill {
    padding: 5px 8px;
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,105,180,0.3);
    border-radius: 15px;
    font-size: 0.72em;
    cursor: pointer;
    transition: opacity 0.3s, transform 0.3s;
    color: var(--ink);
    opacity: 0.85;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 28px;
    overflow: hidden;
    white-space: nowrap;
    box-sizing: border-box;
}

/* Fixed width classes - pills may NOT resize dynamically */
.pill.pill-small { width: 85px; min-width: 85px; max-width: 85px; }
.pill.pill-medium { width: 115px; min-width: 115px; max-width: 115px; }
.pill.pill-large { width: 145px; min-width: 145px; max-width: 145px; }

/* Leading + indicator */
.pill::before { content: "+ "; opacity: 0.7; }

.pill.fade-out { opacity: 0; pointer-events: none; transform: scale(0.95); }
.pill.fade-in { animation: pillFadeIn 0.3s ease forwards; }
.pill.fading { opacity: 0.4; }

/* PAYWALLED ELEMENTS - CURSOR AND VISIBILITY */
.locked-input, .locked-style, .card.locked, .fate-card.locked, .intensity-btn.locked,
.intensity-btn.locked-tease, .intensity-btn.locked-pass, [data-locked] {
    cursor: url('/cursor-dollar-plane-64.png'), pointer !important;
}
.card.locked:hover, .fate-card.locked:hover, .intensity-btn.locked:hover,
.intensity-btn.locked-tease:hover, .intensity-btn.locked-pass:hover,
[data-locked]:hover {
    cursor: url('/cursor-dollar-plane-64.png'), pointer !important;
}
.card.locked *, .fate-card.locked *, .intensity-btn.locked *, [data-locked] * {
    pointer-events: none;
}
.card.locked .preview-btn, [data-locked] .preview-btn {
    pointer-events: auto !important;
    cursor: pointer !important;
}

/* ========================================
   FATE HAND SYSTEM & ROTATING PLACEHOLDERS
   ======================================== */

/* Ancestry container - responsive side-by-side */
.ancestry-container {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
}
.ancestry-subsection {
    flex: 1;
    min-width: 280px;
}
@media (max-width: 640px) {
    .ancestry-container { flex-direction: column; }
    .ancestry-subsection { min-width: 100%; }
}

/* Fate input row - contains input + fate hand */
.fate-input-row {
    display: flex;
    align-items: center;
    gap: 12px;
    position: relative;
}

.fate-input-wrapper {
    flex: 1;
    position: relative;
    min-width: 0;
}

.fate-field {
    width: 100%;
    background: rgba(0,0,0,0.3);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 8px;
    padding: 10px 12px;
    color: #fff;
    font-family: var(--font-main);
    font-size: 0.95em;
}
.fate-field:focus {
    outline: none;
    border-color: var(--pink);
    box-shadow: 0 0 8px rgba(255,105,180,0.3);
}
textarea.fate-field {
    resize: none;
    min-height: 50px;
}

/* Rotating placeholder - matches sb-zoom-rotating-placeholder structure */
.rotating-placeholder {
    position: absolute;
    top: 3px;
    left: 3px;
    right: 3px;
    overflow: hidden;
    pointer-events: none;
    color: rgba(255,255,255,0.4);
    font-size: 0.9em;
    font-style: italic;
    white-space: nowrap;
}
.rotating-placeholder.textarea-placeholder {
    top: 14px;
    transform: none;
}
.rotating-placeholder.hidden { display: none; }

.rotating-placeholder-inner {
    display: inline-block;
    padding-top: 10px;
    animation: scrollPlaceholder 30s linear infinite;
}
.rotating-placeholder-inner .suggestion {
    display: inline;
}
.rotating-placeholder-inner .separator {
    display: inline;
    margin: 0 8px;
    opacity: 0.5;
}
.rotating-placeholder-inner .glow {
    color: var(--gold);
    text-shadow: 0 0 6px var(--gold);
    transition: all 0.5s ease;
}

@keyframes scrollPlaceholder {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
}

/* =================================
   DESTINY FLIP CARD (Quill/Veto)
   Same style as Ancestry card
   ================================= */
.destiny-flip-card {
    /* 2.75 × 4.75 card proportions */
    width: 55px;
    height: 95px;
    perspective: 1000px;
    cursor: pointer;
    flex-shrink: 0;
}
.destiny-card-inner {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.6s ease;
}
.destiny-flip-card.flipped .destiny-card-inner {
    transform: rotateY(180deg);
}
.destiny-card-back,
.destiny-card-front {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 6px;
}
.destiny-card-back {
    background: linear-gradient(145deg, #1a1a1a 0%, #0d0d0d 100%);
    border: 1px solid var(--gold);
    z-index: 2;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 8px;
}
.destiny-card-back::after {
    content: "Destiny's Choice";
    font-family: 'lust-script-display', serif;
    font-size: 10px;
    color: var(--gold);
    text-align: center;
    line-height: 1.3;
}
.destiny-card-front {
    background: url('image_62.png') center/contain no-repeat, #0d0d0d;
    border: 1px solid var(--gold);
    transform: rotateY(180deg);
}

/* Card flip state */
.fate-hand-card.flipping {
    animation: cardFlip 0.45s ease-in-out forwards;
}
.fate-hand-card.fading {
    animation: cardFadeOut 0.3s ease forwards;
}

@keyframes cardFlip {
    0% { transform: rotateY(0deg) rotate(0deg); }
    50% { transform: rotateY(90deg) rotate(0deg) scale(1.1); }
    100% { transform: rotateY(180deg) rotate(0deg) scale(1); }
}
@keyframes cardFadeOut {
    to { opacity: 0; transform: scale(0.8); }
}

/* Fate Tree Card (revealed oracle) - uses image_62.png */
/* 3× original size (original: 32x46), using transform for responsiveness */
.fate-tree-card {
    width: 96px;
    height: 138px; /* 5:7 tarot proportion, 3× original */
    background: url('image_62.png') center/contain no-repeat;
    border: none;
    border-radius: 0;
    position: relative;
    overflow: visible;
    cursor: pointer;
    flex-shrink: 0;
    box-shadow: none;
    transition: transform 0.3s ease;
    transform-origin: center center;
}
.fate-tree-card:hover {
    transform: scale(1.08);
    box-shadow: none;
}
.fate-tree-card.hidden { display: none; }

/* Tree silhouette - hidden when using image_62.png */
.tree-silhouette {
    display: none;
}

/* Falling leaf - REMOVED for now, using static PNG only */
.falling-leaf {
    display: none;
}

/* Stage 1: Fall from mid-air to ground */
.falling-leaf.leaf-fall-1 {
    animation: leafFallStage1 1.2s ease-in forwards;
}
@keyframes leafFallStage1 {
    0%   { top: 23px; right: 7px; transform: rotate(35deg); }
    20%  { right: 9px; transform: rotate(50deg); }
    40%  { right: 5px; transform: rotate(20deg); }
    60%  { right: 10px; transform: rotate(45deg); }
    80%  { right: 6px; transform: rotate(30deg); }
    100% { top: 38px; right: 11px; transform: rotate(40deg); }
}

/* Instant reset to lower branch position */
.falling-leaf.leaf-reset-2 {
    top: 16px;
    right: 5px;
    transform: rotate(25deg);
    animation: none;
}

/* Stage 2: Fall from lower branch to mid-air stop */
.falling-leaf.leaf-fall-2 {
    animation: leafFallStage2 1s ease-in forwards;
}
@keyframes leafFallStage2 {
    0%   { top: 16px; right: 5px; transform: rotate(25deg); }
    25%  { right: 8px; transform: rotate(45deg); }
    50%  { right: 4px; transform: rotate(15deg); }
    75%  { right: 9px; transform: rotate(40deg); }
    100% { top: 27px; right: 7px; transform: rotate(32deg); }
}

/* Final resting state after stage 2 */
.falling-leaf.leaf-final {
    top: 27px;
    right: 7px;
    transform: rotate(32deg);
    animation: none;
}

/* =================================
   ANCESTRY FLIP CARD
   ================================= */
.ancestry-flip-card {
    width: 96px;
    height: 138px;
    perspective: 1000px;
    cursor: pointer;
    flex-shrink: 0;
}
.ancestry-card-inner {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.6s ease;
}
.ancestry-flip-card.flipped .ancestry-card-inner {
    transform: rotateY(180deg);
}
.ancestry-card-back,
.ancestry-card-front {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 6px;
}
.ancestry-card-back {
    background: linear-gradient(145deg, #1a1a1a 0%, #0d0d0d 100%);
    border: 1px solid var(--gold);
    z-index: 2;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 8px;
}
.ancestry-card-back::after {
    content: "Destiny's Choice";
    font-family: 'lust-script-display', serif;
    font-size: 12px;
    color: var(--gold);
    text-align: center;
    line-height: 1.3;
}
.ancestry-card-front {
    background: url('image_62.png') center/contain no-repeat, #0d0d0d;
    border: 1px solid var(--gold);
    transform: rotateY(180deg);
}

/* =================================
   CHARACTER SECTION HEADER & DESTINY CARDS
   ================================= */
.character-section-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 15px;
}

.character-section-title {
    font-family: 'lust-script-display', 'lust-script', serif;
    font-size: 1.3em;
    color: var(--gold);
    text-shadow: 0 0 8px rgba(218, 165, 32, 0.3);
}

.character-destiny-card {
    width: 40px;
    height: 56px;
    perspective: 800px;
    cursor: pointer;
    transition: transform 0.3s ease;
    flex-shrink: 0;
}

.character-destiny-card:hover {
    transform: scale(1.1);
}

.character-destiny-card.flipped .character-destiny-inner {
    transform: rotateY(180deg);
}

.character-destiny-inner {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.6s ease;
}

.character-destiny-face {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
}

.character-destiny-back {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    border: 1px solid var(--gold);
}

.character-destiny-back::after {
    content: "⚜";
    font-size: 16px;
    color: var(--gold);
    text-shadow: 0 0 6px rgba(218, 165, 32, 0.5);
}

.character-destiny-front {
    background: linear-gradient(135deg, #2d1810 0%, #4a2c17 50%, #6b3a1f 100%);
    border: 1px solid var(--gold);
    transform: rotateY(180deg);
}

.character-destiny-front::after {
    content: "✦";
    font-size: 14px;
    color: var(--gold);
    text-shadow: 0 0 6px rgba(218, 165, 32, 0.5);
}

/* =================================
   PASS 9B: HORIZONTAL CHARACTER BLOCKS
   Destiny card LEFT, fields in responsive row
   ================================= */
.fate-shortcut-vertical {
    flex-direction: column;
    align-items: center;
    gap: 12px;
}

/* PASS 9F: Unified horizontal container rule for all sections */
.sb-section-container {
    width: 95%;
    margin-inline: auto;
    box-sizing: border-box;
}

.character-block-horizontal {
    display: flex;
    align-items: stretch;
    gap: 12px;
    width: 95%;
    max-width: none;
    margin: 0 auto 15px;
    padding: 0;
    box-sizing: border-box;
}

.character-destiny-side {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    min-width: 55px;
}

.character-destiny-card-tall {
    /* 2.75 × 4.75 card proportions */
    width: 55px;
    height: 95px;
    perspective: 800px;
    cursor: pointer;
    transition: transform 0.3s ease;
    flex-shrink: 0;
}

.character-destiny-card-tall:hover {
    transform: scale(1.05);
}

.character-destiny-card-tall .character-destiny-inner {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.6s ease;
}

.character-destiny-card-tall.flipped .character-destiny-inner {
    transform: rotateY(180deg);
}

.character-destiny-card-tall .character-destiny-face {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 3px 12px rgba(0, 0, 0, 0.4);
}

.character-destiny-card-tall .character-destiny-back {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    border: 1px solid var(--gold);
}

.character-destiny-card-tall .character-destiny-back::after {
    content: "Destiny's Choice";
    font-family: 'lust-script-display', serif;
    font-size: 10px;
    color: var(--gold);
    text-align: center;
    line-height: 1.3;
    text-shadow: 0 0 8px rgba(218, 165, 32, 0.5);
}

.character-destiny-card-tall .character-destiny-front {
    background: linear-gradient(135deg, #2d1810 0%, #4a2c17 50%, #6b3a1f 100%);
    border: 1px solid var(--gold);
    transform: rotateY(180deg);
}

.character-destiny-card-tall .character-destiny-front::after {
    content: "Destiny's Choice";
    font-family: 'lust-script-display', serif;
    font-size: 10px;
    color: var(--gold);
    text-align: center;
    line-height: 1.3;
    text-shadow: 0 0 8px rgba(218, 165, 32, 0.5);
}

.character-fields-side {
    flex: 1;
    min-width: 0;
}

.character-fields-row {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.character-field {
    display: flex;
    flex-direction: column;
    min-width: 0;
}

.character-field label {
    display: block;
    text-align: left;
    color: var(--gold);
    margin-bottom: 4px;
    font-size: 0.8em;
    font-family: var(--font-main);
    text-transform: uppercase;
    letter-spacing: 1px;
}

.character-field input,
.character-field select {
    padding: 6px 8px;
    font-size: 0.95em;
}

/* PASS 9F: Ensure ancestry text is never clipped */
.character-field-ancestry input {
    overflow: visible;
    text-overflow: clip;
}

.character-field-name {
    flex: 3;
    min-width: 140px;
}

.character-field-gender {
    flex: 0 0 90px;
    min-width: 80px;
    max-width: 100px;
}

.character-field-pronouns {
    flex: 0 0 90px;
    min-width: 80px;
    max-width: 100px;
}

.character-field-ancestry {
    flex: 2;
    min-width: 140px;
    position: relative;
}

.character-field-ancestry .rotating-placeholder {
    top: 14px;
}

/* PASS 9D: Age field - compact numeric input */
.character-field-age {
    flex: 0 0 60px;
    min-width: 50px;
    max-width: 70px;
}

.character-field-age input {
    text-align: center;
    -moz-appearance: textfield;
}

.character-field-age input::-webkit-outer-spin-button,
.character-field-age input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

.custom-gender-input {
    margin-top: 5px;
    padding: 8px 10px !important;
    font-size: 0.9em !important;
}

/* Ancestry field WHITE text (not yellow) */
.ancestry-field {
    color: #fff !important;
}

/* Responsive: Stack fields on narrow screens */
@media (max-width: 600px) {
    .character-block-horizontal {
        flex-direction: column;
        align-items: stretch;
    }

    .character-destiny-side {
        margin-bottom: 10px;
    }

    .character-destiny-card-tall {
        width: 60px;
        height: 84px;
    }

    .character-fields-row {
        flex-direction: column;
    }

    .character-field {
        width: 100%;
    }

    .character-field-name,
    .character-field-gender,
    .character-field-pronouns,
    .character-field-ancestry,
    .character-field-age {
        flex: none;
        min-width: auto;
    }

    .character-field-age {
        max-width: none;
        width: 100%;
    }
}

/* PASS 9F: Quill-Veto container - unified margins with other sections */
/* Primary grid definition is at line ~897 */
.qv-section {
    width: 100%;
}
.fate-textarea-wrapper {
    width: 100%;
}

/* Committed Phrases (Debossed/Carved Look) */
.committed-phrases {
    max-height: 120px;
    overflow-y: auto;
    margin-bottom: 8px;
    display: flex;
    flex-direction: column;
    gap: 4px;
}
.committed-phrases:empty { display: none; }
.committed-phrase {
    display: flex;
    align-items: flex-start;
    gap: 6px;
    padding: 6px 10px;
    background: linear-gradient(145deg, #1a1a1a, #0d0d0d);
    border: 1px solid rgba(60,60,60,0.5);
    border-radius: 4px;
    box-shadow: inset 2px 2px 4px rgba(0,0,0,0.8), inset -1px -1px 2px rgba(50,50,50,0.3);
    font-size: 0.85em;
    color: rgba(180,180,180,0.9);
    font-family: var(--font-main);
    text-shadow: 0 1px 0 rgba(0,0,0,0.5);
    letter-spacing: 0.02em;
}
.committed-phrase.quill-phrase {
    color: rgba(200,180,140,0.9);
    border-color: rgba(180,140,60,0.3);
}
.committed-phrase.veto-phrase {
    color: rgba(180,160,170,0.9);
    border-color: rgba(140,100,120,0.3);
}
.committed-phrase-text {
    flex: 1;
    line-height: 1.4;
    white-space: pre-wrap;
}
.committed-phrase-remove {
    background: none;
    border: none;
    color: rgba(255,255,255,0.3);
    cursor: pointer;
    font-size: 1em;
    padding: 0;
    line-height: 1;
    transition: color 0.2s;
}
.committed-phrase-remove:hover {
    color: var(--pink);
}

/* ═══════════════════════════════════════════════════════════════════
   STORYBOUND CUSTOM RADIO BUTTONS — Gold X imagery
   ═══════════════════════════════════════════════════════════════════ */

/* Container label - makes entire row clickable */
.sb-radio {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    position: relative;
    padding: 4px 0;
    user-select: none;
}

/* Hide native radio visually but keep it focusable/accessible */
.sb-radio input[type="radio"] {
    position: absolute;
    opacity: 0;
    width: 48px;
    height: 48px;
    margin: 0;
    cursor: pointer;
    z-index: 1;
}

/* Custom visual - default (unselected) state */
/* DOUBLED SIZE: 24px → 48px for better visibility */
.sb-radio-visual {
    width: 48px;
    height: 48px;
    flex-shrink: 0;
    background-image: url('Square%20Radio%20Button-no-x-200x200.jpg');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    border-radius: 4px;
    transition: filter 0.15s ease, box-shadow 0.15s ease;
}

/* Selected state - swap to X image */
.sb-radio input[type="radio"]:checked + .sb-radio-visual {
    background-image: url('Square%20Radio%20Button-x-200x200.jpg');
}

/* Hover state - subtle gold brighten */
.sb-radio:hover .sb-radio-visual {
    filter: brightness(1.15);
}

/* Focus-visible state - thin gold outline for keyboard users */
.sb-radio input[type="radio"]:focus-visible + .sb-radio-visual {
    box-shadow: 0 0 0 2px var(--gold);
    outline: none;
}

/* Disabled state - visually muted */
.sb-radio input[type="radio"]:disabled + .sb-radio-visual {
    filter: grayscale(0.7) brightness(0.6);
    cursor: not-allowed;
}
.sb-radio:has(input[type="radio"]:disabled) {
    cursor: not-allowed;
    opacity: 0.6;
}

/* Label text styling - DOUBLED SIZE */
.sb-radio-label {
    color: var(--ink);
    font-size: 1.4em;
    line-height: 1.3;
}

/* Radio group container - vertical layout */
.sb-radio-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: flex-start;
}

/* Radio group container - horizontal layout */
.sb-radio-group.horizontal {
    flex-direction: row;
    flex-wrap: wrap;
    gap: 16px;
}

/* ═══════════════════════════════════════════════════════════════════
   STORYBOUND CUSTOM CHECKBOXES — Gold X imagery (same as radios)
   ═══════════════════════════════════════════════════════════════════ */

/* Container label - makes entire row clickable */
.sb-checkbox {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    position: relative;
    padding: 4px 0;
    user-select: none;
}

/* Hide native checkbox visually but keep it focusable/accessible */
.sb-checkbox input[type="checkbox"] {
    position: absolute;
    opacity: 0;
    width: 48px;
    height: 48px;
    margin: 0;
    cursor: pointer;
    z-index: 1;
}

/* Custom visual - default (unchecked) state */
/* DOUBLED SIZE: 24px → 48px for better visibility */
.sb-checkbox-visual {
    width: 48px;
    height: 48px;
    flex-shrink: 0;
    background-image: url('Square%20Radio%20Button-no-x-200x200.jpg');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    border-radius: 4px;
    transition: filter 0.15s ease, box-shadow 0.15s ease;
}

/* Checked state - swap to X image */
.sb-checkbox input[type="checkbox"]:checked + .sb-checkbox-visual {
    background-image: url('Square%20Radio%20Button-x-200x200.jpg');
}

/* Hover state - subtle gold brighten */
.sb-checkbox:hover .sb-checkbox-visual {
    filter: brightness(1.15);
}

/* Focus-visible state - thin gold outline for keyboard users */
.sb-checkbox input[type="checkbox"]:focus-visible + .sb-checkbox-visual {
    box-shadow: 0 0 0 2px var(--gold);
    outline: none;
}

/* Disabled state - visually muted */
.sb-checkbox input[type="checkbox"]:disabled + .sb-checkbox-visual {
    filter: grayscale(0.7) brightness(0.6);
    cursor: not-allowed;
}
.sb-checkbox:has(input[type="checkbox"]:disabled) {
    cursor: not-allowed;
    opacity: 0.6;
}

/* Label text styling - DOUBLED SIZE */
.sb-checkbox-label {
    color: var(--ink);
    font-size: 1.4em;
    line-height: 1.3;
}

/* Checkbox group container */
.sb-checkbox-group {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    justify-content: center;
}

/* ═══════════════════════════════════════════════════════════════════
   BOOK COVER PAGE - Physical book object in app environment
   ═══════════════════════════════════════════════════════════════════ */

.book-cover-page {
    position: fixed;
    inset: 0;
    background: linear-gradient(135deg, var(--bg1), var(--bg2));
    z-index: 2000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 20px;
    box-sizing: border-box;
    perspective: 1500px;
}

.book-cover-page.hidden {
    display: none;
}

/* Night Mode - dims environment only, not book */
.book-cover-page.night-mode {
    background: linear-gradient(135deg, #151515, #1a1a1a);
}

/* Loading State */
.cover-loading {
    text-align: center;
    max-width: 400px;
    width: 100%;
}

.cover-progress-bar {
    width: 100%;
    height: 8px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 999px;
    overflow: hidden;
    margin-bottom: 20px;
    border: 1px solid rgba(255, 105, 180, 0.3);
}

.cover-progress-fill {
    width: 0%;
    height: 100%;
    background: linear-gradient(90deg, var(--pink), var(--hot));
    border-radius: 999px;
    transition: width 0.3s ease;
}

.cover-status-text {
    font-family: 'lust-script-display', serif;
    font-size: 1.3em;
    color: var(--gold);
    margin: 0;
    animation: statusPulse 2s ease-in-out infinite;
}

@keyframes statusPulse {
    0%, 100% { opacity: 0.7; }
    50% { opacity: 1; }
}

@keyframes pulse {
    0%, 100% { opacity: 0.4; }
    50% { opacity: 1; }
}

.name-refining-indicator {
    display: inline;
    margin-left: 8px;
    font-size: 0.85em;
    color: #888;
    font-style: italic;
}

.name-refining-indicator .refining-dot {
    animation: pulse 1s infinite;
    margin-right: 4px;
}

/* ═══════════════════════════════════════════════════════════════════
   PHYSICAL BOOK OBJECT - 3D book with hinge, thickness, shadows
   ═══════════════════════════════════════════════════════════════════ */

.book-object {
    position: relative;
    width: 320px;
    height: 480px;
    transform-style: preserve-3d;
    cursor: pointer;
    animation: bookAppear 0.8s ease forwards;
}

.book-object.hidden {
    display: none;
}

@keyframes bookAppear {
    from { opacity: 0; transform: scale(0.9) rotateY(-5deg); }
    to { opacity: 1; transform: scale(1) rotateY(0deg); }
}

/* Book cover - the front face that hinges open */
.book-cover {
    position: absolute;
    inset: 0;
    transform-origin: left center;
    transform-style: preserve-3d;
    transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    z-index: 10;
    border-radius: 2px 8px 8px 2px;
    overflow: hidden;
    /* Right and bottom edge shadows for depth */
    box-shadow:
        4px 4px 8px rgba(0, 0, 0, 0.4),
        8px 8px 20px rgba(0, 0, 0, 0.3),
        inset -3px 0 8px rgba(0, 0, 0, 0.2);
}

.book-cover::after {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    width: 30px;
    background: linear-gradient(to left, rgba(0,0,0,0.15), transparent);
    pointer-events: none;
    border-radius: 0 8px 8px 0;
}

.book-cover-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 2px 8px 8px 2px;
    display: block;
    backface-visibility: hidden;
}

/* Inside cover face — neutral parchment surface visible when cover hinges open */
.book-cover::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, #f5f0e6 0%, #ebe5d6 40%, #e8e0d0 100%);
    border-radius: 2px 8px 8px 2px;
    transform: rotateY(180deg);
    backface-visibility: hidden;
    z-index: 0;
}

/* Hinge states */
.book-cover.hinge-peek {
    transform: rotateY(-15deg);
}

.book-cover.hinge-open {
    transform: rotateY(-160deg);
    pointer-events: none;
}

/* Book spine - left edge thickness */
.book-spine {
    position: absolute;
    left: -12px;
    top: 0;
    bottom: 0;
    width: 12px;
    background: linear-gradient(to right, #2a1a10, #3d2817);
    transform: rotateY(-90deg) translateX(-6px);
    transform-origin: right center;
    border-radius: 2px 0 0 2px;
}

/* Book thickness - bottom/side depth */
.book-thickness {
    position: absolute;
    left: 0;
    right: 0;
    bottom: -8px;
    height: 8px;
    background: linear-gradient(to bottom, #f5f0e6, #e8e0d0);
    transform: rotateX(90deg) translateY(4px);
    transform-origin: top center;
    border-radius: 0 0 2px 2px;
}

/* Page edges visible from the side */
.book-pages-preview {
    position: absolute;
    inset: 4px;
    right: 4px;
    background: linear-gradient(to right, #f8f4eb, #f0ebe0);
    border-radius: 0 6px 6px 0;
    z-index: 5;
    overflow: hidden;
}

.page-edge-stack {
    position: absolute;
    right: 0;
    top: 10px;
    bottom: 10px;
    width: 8px;
    background: repeating-linear-gradient(
        to bottom,
        #f5f0e6 0px,
        #f5f0e6 1px,
        #e0d8c8 1px,
        #e0d8c8 2px
    );
    border-radius: 0 4px 4px 0;
}

/* ═══════════════════════════════════════════════════════════════════
   BOOKMARK RIBBON - Visual indicator for returning readers
   ═══════════════════════════════════════════════════════════════════ */

.bookmark-ribbon {
    position: absolute;
    top: -8px;
    right: 30px;
    width: 20px;
    height: 60px;
    background: linear-gradient(135deg, #8b0000, #a01010);
    z-index: 20;
    clip-path: polygon(0 0, 100% 0, 100% 85%, 50% 100%, 0 85%);
    box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    transition: opacity 0.3s ease;
}

.bookmark-ribbon.hidden {
    display: none;
}

.bookmark-ribbon::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 100%;
    background: linear-gradient(to right, transparent, rgba(255,255,255,0.1), transparent);
}

/* ═══════════════════════════════════════════════════════════════════
   COURTESY HINGE ANIMATION - One-time learning cue
   ═══════════════════════════════════════════════════════════════════ */

@keyframes courtesyHingePeek {
    0% { transform: rotateY(0deg); }
    40% { transform: rotateY(-18deg); }
    60% { transform: rotateY(-18deg); }
    100% { transform: rotateY(0deg); }
}

.book-cover.courtesy-peek {
    animation: courtesyHingePeek 2s ease-in-out forwards;
}

/* ═══════════════════════════════════════════════════════════════════
   PAGE-TURN ANIMATION OVERLAY
   ═══════════════════════════════════════════════════════════════════ */

.page-turn-overlay {
    position: fixed;
    inset: 0;
    z-index: 2500;
    pointer-events: none;
    perspective: 2000px;
}

.page-turn-overlay.hidden {
    display: none;
}

.page-turn-overlay.active {
    pointer-events: auto;
}

.page-turn-left,
.page-turn-right {
    position: absolute;
    top: 0;
    width: 50%;
    height: 100%;
    background: linear-gradient(135deg, var(--bg1), var(--bg2));
    transform-origin: center;
    backface-visibility: hidden;
}

.page-turn-left {
    left: 0;
    transform-origin: right center;
    border-right: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: inset -20px 0 40px rgba(0, 0, 0, 0.3);
}

.page-turn-right {
    right: 0;
    transform-origin: left center;
    border-left: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: inset 20px 0 40px rgba(0, 0, 0, 0.3);
}

/* Page Turn Animation Classes */
.page-turn-overlay.turning .page-turn-left {
    animation: pageTurnLeftOpen 1.2s ease-in-out forwards;
}

.page-turn-overlay.turning .page-turn-right {
    animation: pageTurnRightOpen 1.2s ease-in-out forwards;
}

@keyframes pageTurnLeftOpen {
    0% {
        transform: rotateY(0deg);
    }
    100% {
        transform: rotateY(-120deg);
    }
}

@keyframes pageTurnRightOpen {
    0% {
        transform: rotateY(0deg);
    }
    100% {
        transform: rotateY(120deg);
    }
}

/* Story Content Container */
.story-content {
    opacity: 1;
    transition: opacity 0.5s ease;
}

.story-content.hidden {
    display: none;
}

.story-content.fade-in {
    animation: storyFadeIn 0.8s ease forwards;
}

@keyframes storyFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* Reduced Motion Accessibility */
@media (prefers-reduced-motion: reduce) {
    .cover-status-text {
        animation: none;
    }

    .book-object {
        animation: none;
        opacity: 1;
        transform: scale(1);
    }

    .book-cover {
        transition-duration: 0.2s;
    }

    .book-cover.courtesy-peek {
        animation: none;
    }

    .book-cover.hinge-open {
        transition-duration: 0.3s;
    }

    .page-turn-overlay.turning .page-turn-left,
    .page-turn-overlay.turning .page-turn-right {
        animation-duration: 0.3s;
    }

    .story-content.fade-in {
        animation: none;
        opacity: 1;
    }
}

/* ═══════════════════════════════════════════════════════════════════
   FLOATING SYNOPSIS PANEL - Live-updating story preview
   ═══════════════════════════════════════════════════════════════════

   LOCKED DESIGN RULE:
   The floating synopsis panel must remain visually restrained and literary.
   It should feel like an authorial whisper, not a system notification.
   No glassmorphism, glow effects, or color-coded highlighting.

   CORRECTIVE PASS: Converted to side-mounted floating card (5x7 book jacket)
   - Positioned to the right of main content on desktop
   - Sticky within the 4-axis selection range only
   - Feels like a quiet accompanying object, not page chrome
   ═══════════════════════════════════════════════════════════════════ */

.synopsis-panel {
    position: fixed;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    z-index: 100;
    background: rgba(18, 8, 22, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.12);
    border-radius: 6px;
    padding: 24px 20px;
    /* 5:7 aspect ratio like book jacket card - width ~180px, height ~252px */
    width: 180px;
    min-height: 220px;
    max-height: 280px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
    /* Hidden by default - JS controls visibility based on scroll position */
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
}

/* Visible state - controlled by JS when within 4-axis range */
.synopsis-panel.visible {
    opacity: 1;
    visibility: visible;
}

.synopsis-text {
    font-family: 'Lora', 'Georgia', serif;
    font-size: 0.85em;
    line-height: 1.65;
    color: rgba(255, 255, 255, 0.75);
    margin: 0;
    text-align: left;
    font-style: italic;
    letter-spacing: 0.01em;
}

/* All clause spans share the same restrained styling */
.synopsis-text span {
    transition: opacity 0.4s ease;
    color: inherit;
    font-weight: inherit;
    display: block;
    margin-bottom: 8px;
}

/* Subtle emphasis when clause updates - slight opacity pulse only */
.synopsis-text span.updating {
    opacity: 1;
    color: rgba(255, 255, 255, 0.95);
}

/* Mobile: DSP pins to top of viewport, floats above content */
@media (max-width: 1100px) {
    .synopsis-panel {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: auto;
        transform: none;
        width: 100%;
        max-width: none;
        min-height: auto;
        max-height: none;
        margin: 0;
        padding: 12px 20px;
        border-radius: 0;
        border-left: none;
        border-right: none;
        border-top: none;
        opacity: 1;
        visibility: visible;
        z-index: 500; /* Above content, below modals */
        background: rgba(18, 8, 22, 0.97);
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.5);
    }

    .synopsis-text {
        font-size: 0.9em;
        text-align: center;
        line-height: 1.5;
    }

    .synopsis-text span {
        display: inline;
        margin-bottom: 0;
    }

    /* Add top padding to setup screen when DSP is floating */
    #setup {
        padding-top: 90px !important;
    }
}

/* ═══════════════════════════════════════════════════════════════════
   RELATIONSHIP DYNAMIC GROUPINGS
   Visual organization only - selection logic remains flat/single-select
   ═══════════════════════════════════════════════════════════════════ */

/* PASS 9F: Relationship Dynamics - unified margins with other sections */
.dynamic-grouped {
    display: flex;
    flex-direction: column;
    gap: 20px;
    width: 95%;
    margin: 20px auto;
    padding: 0;
    box-sizing: border-box;
}

.dynamic-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
    width: 100%;
}

.dynamic-group-label {
    font-family: 'Lora', 'Georgia', serif;
    font-size: 0.85em;
    font-weight: 500;
    color: rgba(255, 255, 255, 0.45);
    text-transform: uppercase;
    letter-spacing: 0.12em;
    text-align: center;
    margin-bottom: 2px;
}

/* Dynamic group inherits flex spread from .style-cards */
.dynamic-group .style-cards {
    gap: 14px 16px;
}

/* ═══════════════════════════════════════════════════════════════════
   CANONICAL STORYBOUND CARD SYSTEM (SB-CARD)
   ONE card component used everywhere. 5×7 vertical aspect ratio.
   ═══════════════════════════════════════════════════════════════════ */

/* Grid System - FLEXBOX for TRUE ROW-LEVEL CENTERING (PASS 8M)

   CRITICAL FIX: Using flexbox instead of CSS Grid.
   With flexbox + justify-content: center, EACH WRAPPED ROW is centered.
   Example: 9 cards → 5+4 layout, both rows centered independently.

   RULES:
   - Row lengths must differ by AT MOST 1
   - Never allow layouts like 5+5+1, 6+1, 4+2, 8+3, 3+1
   - EACH ROW is visually centered (not just the container)
   - Cards never shrink before 2-column mode

   SIZE-SPECIFIC CLASSES (apply to grids):
   - .sb-grid-4: 4 cards → Wide: 4, Medium: 2,2, Narrow: 2,2
   - .sb-grid-5: 5 cards → Wide: 5, Medium: 3,2, Narrow: 2,2,1
   - .sb-grid-6: 6 cards → Wide: 6, Medium: 3,3, Narrow: 2,2,2
   - .sb-grid-9: 9 cards → Wide: 5,4, Medium: 3,3,3, Narrow: 2,2,2,2,1

   Column math (card=100px, gap=16px):
   - 6 cols: 680px, 5 cols: 564px, 4 cols: 448px
   - 3 cols: 332px, 2 cols: 216px
   - At narrow: cards=70px, gap=8px, 2 cols: 148px
*/
/* Card grid - 5 cards max per row, centered with margin on ultra-wide */
.sb-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    justify-content: center;
    align-content: start;
    width: 95%;
    max-width: 814px; /* 5 cards max: 5×150 + 4×16 */
    margin-inline: auto;
    margin-block: 20px;
}

/* Size-specific grids inherit max-width cap */
.sb-grid-4, .sb-grid-5, .sb-grid-6, .sb-grid-9 {
    width: 95%;
}

/* Medium screens */
@media (max-width: 700px) {
    .sb-grid,
    .sb-grid-4,
    .sb-grid-5,
    .sb-grid-6,
    .sb-grid-9 {
        width: 95%;
    }
}

/* Narrow screens: tighter gap */
@media (max-width: 400px) {
    .sb-grid,
    .sb-grid-4,
    .sb-grid-5,
    .sb-grid-6,
    .sb-grid-9 {
        width: 95%;
        gap: 8px;
    }
}

/* Base Card - 5×7 vertical proportions, ~50% larger for readability */
.sb-card {
    width: 150px;
    height: 210px; /* 5:7 ratio */
    perspective: 1000px;
    cursor: pointer;
}

/* Responsive card sizes */
@media (max-width: 400px) {
    .sb-card { width: 105px; height: 147px; }
}

/* Inner wrapper for 3D flip */
.sb-card-inner {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.5s ease;
}

/* Flipped state */
.sb-card.flipped .sb-card-inner {
    transform: rotateY(180deg);
}

/* Both faces share common styles */
.sb-card-face {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 8px;
    box-sizing: border-box;
    overflow: hidden;
}

/* BACK FACE - Initially visible (unclicked state), shows TITLE ONLY */
.sb-card-back {
    background: linear-gradient(145deg, #1a1a1a 0%, #0d0d0d 100%);
    border: 1px solid var(--gold);
    z-index: 2;
    text-align: center;
    justify-content: center;
}

.sb-card-back .sb-card-title {
    font-family: 'lust-script-display', serif;
    font-size: 18px;
    color: var(--gold);
    line-height: 1.2;
    word-wrap: break-word;
    word-spacing: 100vw; /* Force one word per line for multi-word titles */
    text-align: center;
}

/* FRONT FACE - Revealed on flip (clicked state), shows title + description + flavors */
.sb-card-front {
    background: linear-gradient(145deg, #2a1a2a 0%, #1a0a1a 100%);
    border: 1px solid var(--pink);
    transform: rotateY(180deg);
    justify-content: flex-start;
    padding-top: 10px;
}

.sb-card-front .sb-card-title {
    font-family: 'lust-script-display', serif;
    font-size: 15px;
    color: var(--gold);
    line-height: 1.1;
    margin-bottom: 6px;
    word-spacing: 100vw;
    text-align: center;
}

.sb-card-front .sb-card-desc {
    font-size: 8px;
    color: var(--ink);
    line-height: 1.2;
    text-align: center;
    flex: 1;
    display: flex;
    align-items: center;
}

.sb-card-front .sb-card-flavors {
    display: flex;
    flex-wrap: wrap;
    gap: 3px;
    justify-content: center;
    margin-top: auto;
    padding-top: 4px;
}

.sb-card-front .sb-card-flavor {
    font-size: 6px;
    padding: 2px 4px;
    background: rgba(255, 105, 180, 0.2);
    border: 1px solid var(--pink);
    border-radius: 3px;
    color: var(--pink);
    cursor: pointer;
}

/* Selected state - glow effect */
.sb-card.selected {
    filter: drop-shadow(0 0 10px var(--hot));
}

.sb-card.selected .sb-card-back {
    border-color: var(--pink);
}

/* Locked state */
.sb-card.locked {
    opacity: 0.5;
    filter: grayscale(0.8);
    cursor: url('/cursor-dollar-plane-64.png'), pointer !important;
}

.sb-card.locked::after {
    content: "";
    position: absolute;
    top: 5px;
    right: 5px;
    width: 18px;
    height: 18px;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M17.5 13.5a3.5 3.5 0 1 0-2.5-5.9l-1.5 1.5'%3E%3C/path%3E%3Cpath d='M6.5 10.5a3.5 3.5 0 1 0 2.5 5.9l1.5-1.5'%3E%3C/path%3E%3Cpath d='M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0-2 0'%3E%3C/path%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-size: contain;
    opacity: 0.9;
    pointer-events: none;
    z-index: 10;
}

/* PASS 8M: Locked card hover preview - flips to show description while staying locked
   Card remains greyed/locked, but user can preview description on hover.
   Click still triggers paywall modal (no selection occurs). */
.sb-card.locked:hover .sb-card-inner {
    transform: rotateY(180deg);
}

/* Keep locked styling during hover-flip preview */
.sb-card.locked:hover {
    opacity: 0.6; /* Slightly brighter on hover but still dimmed */
    filter: grayscale(0.6);
}

/* Dimmed state during zoom */
.sb-card.dimmed {
    opacity: 0.3;
    pointer-events: none;
    filter: blur(1px);
}

/* ═══════════════════════════════════════════════════════════════════
   IN-PLACE CARD ZOOM (THREE-STATE MODEL)
   Card scales and translates from grid position to viewport center
   NO separate modal or popup elements
   ═══════════════════════════════════════════════════════════════════ */

/* Zoom backdrop - dims background when card is zoomed */
.sb-zoom-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.85);
    z-index: 999;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
}

.sb-zoom-backdrop.active {
    opacity: 1;
    pointer-events: auto;
}

/* Zoomed card state - transforms the SAME card element */
.sb-card.zoomed {
    position: relative;
    z-index: 1000;
    /* Transform is set dynamically via JS to center the card */
    transition: transform 0.3s ease;
    pointer-events: auto !important;
    opacity: 1 !important;
    filter: none !important;
}

/* When zoomed, the inner card should not flip back */
.sb-card.zoomed .sb-card-inner {
    transform: rotateY(180deg); /* Keep showing front face */
}

/* Zoomed card visual enhancement */
.sb-card.zoomed .sb-card-front {
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6),
                0 0 30px rgba(255, 105, 180, 0.3);
}

/* Flavor count indicator on face-up cards */
.sb-card-front .sb-card-flavor-count {
    position: absolute;
    bottom: 6px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 7px;
    color: var(--gold);
    background: rgba(201, 162, 39, 0.2);
    padding: 2px 6px;
    border-radius: 8px;
    border: 1px solid rgba(201, 162, 39, 0.4);
}

/* Hide flavor count when card is zoomed - flavor pills are visible instead */
.sb-card.zoomed .sb-card-flavor-count {
    display: none;
}

/* ═══════════════════════════════════════════════════════════════════
   WORLD ZOOM CONTENT - Flavor buttons and custom field inside zoomed card
   ═══════════════════════════════════════════════════════════════════ */

/* Container for zoom content inside card front */
.sb-zoom-content {
    display: flex;
    flex-direction: column;
    gap: 4px;
    margin-top: 4px;
    width: 100%;
    padding: 0 3px;
    box-sizing: border-box;
}

/* Flavor buttons grid */
.sb-zoom-flavors {
    display: flex;
    flex-wrap: wrap;
    gap: 2px;
    justify-content: center;
}

/* Individual flavor button */
.sb-flavor-btn {
    font-size: 5px;
    padding: 2px 4px;
    background: rgba(255, 105, 180, 0.15);
    border: 1px solid rgba(255, 105, 180, 0.4);
    border-radius: 3px;
    color: var(--ink);
    cursor: pointer;
    transition: all 0.2s ease;
    font-family: 'Crimson Text', serif;
}

.sb-flavor-btn:hover {
    background: rgba(255, 105, 180, 0.3);
    border-color: var(--pink);
}

.sb-flavor-btn.selected {
    background: rgba(255, 105, 180, 0.5);
    border-color: var(--hot);
    color: white;
    box-shadow: 0 0 4px rgba(255, 20, 147, 0.5);
}

/* Custom setting wrapper */
.sb-zoom-custom {
    margin-top: 3px;
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.sb-zoom-custom-label {
    font-size: 5px;
    color: var(--gold);
    text-align: left;
}

.sb-zoom-custom-wrapper {
    position: relative;
    width: 100%;
}

.sb-zoom-custom-input {
    font-size: 5px;
    padding: 3px;
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(255, 105, 180, 0.3);
    border-radius: 3px;
    color: var(--ink);
    resize: none;
    font-family: 'Crimson Text', serif;
    width: 100%;
    box-sizing: border-box;
}

/* Rotating placeholder for custom field */
.sb-zoom-rotating-placeholder {
    position: absolute;
    top: 3px;
    left: 3px;
    right: 3px;
    overflow: hidden;
    pointer-events: none;
    font-size: 5px;
    color: var(--ink);
    opacity: 0.5;
    font-style: italic;
    white-space: nowrap;
}

.sb-zoom-rotating-placeholder.hidden {
    display: none;
}

.sb-zoom-placeholder-inner {
    display: inline-block;
    animation: scrollPlaceholderZoom 25s linear infinite;
}

.sb-zoom-placeholder-inner .suggestion {
    display: inline;
}

.sb-zoom-placeholder-inner .separator {
    display: inline;
    margin: 0 4px;
    opacity: 0.5;
}

@keyframes scrollPlaceholderZoom {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
}

.sb-zoom-custom-input:focus {
    outline: none;
    border-color: var(--pink);
    background: rgba(0, 0, 0, 0.6);
}

.sb-zoom-custom-input::placeholder {
    color: rgba(200, 200, 200, 0.4);
    font-style: italic;
}

/* Storybeau (archetype) zoom - NO pills, only custom field with scrolling modifiers */
.sb-zoom-content-storybeau {
    justify-content: center;
    flex: 1;
}

.sb-zoom-content-storybeau .sb-zoom-custom {
    margin-top: 0;
}

/* Incompatible/dimmed state */
.sb-card.incompatible,
.sb-card.layer-locked {
    opacity: 0.3;
    pointer-events: none;
    filter: grayscale(0.5);
}

/* Hover state */
.sb-card:hover:not(.locked):not(.incompatible):not(.layer-locked) {
    transform: translateY(-3px);
}

.sb-card:hover:not(.locked):not(.incompatible):not(.layer-locked) .sb-card-back {
    border-color: var(--pink);
}

/* ========================================
   FATE DESTINY CARD - Let Fate Decide
   ======================================== */
.fate-shortcut-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    margin: 10px 0 25px;
    flex-wrap: wrap;
}

.fate-shortcut-text {
    font-family: 'lust-script-display', 'lust-script', serif;
    font-size: 1.4em;
    color: var(--gold);
    font-style: italic;
    text-shadow: 0 0 10px rgba(218, 165, 32, 0.3);
}

.fate-destiny-card {
    width: 80px;
    height: 112px;
    perspective: 800px;
    cursor: pointer;
    transition: transform 0.3s ease;
}

.fate-destiny-card:hover {
    transform: scale(1.05);
}

.fate-destiny-card.flipped .fate-destiny-inner {
    transform: rotateY(180deg);
}

.fate-destiny-inner {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.6s ease;
}

.fate-destiny-face {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
}

.fate-destiny-back {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    border: 2px solid var(--gold);
    padding: 10px;
}

.fate-destiny-title {
    font-family: 'lust-script-display', 'lust-script', serif;
    font-size: 0.9em;
    color: var(--gold);
    text-align: center;
    text-shadow: 0 0 8px rgba(218, 165, 32, 0.5);
    line-height: 1.2;
}

.fate-destiny-front {
    background: linear-gradient(135deg, #2d1810 0%, #4a2c17 50%, #6b3a1f 100%);
    border: 2px solid var(--gold);
    transform: rotateY(180deg);
}

.fate-golden-tree {
    width: 60px;
    height: 80px;
    background: radial-gradient(ellipse at center bottom, var(--gold) 0%, transparent 70%),
                linear-gradient(to top, var(--gold) 0%, transparent 40%);
    mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 60 80'%3E%3Cpath d='M30 5 L45 25 L38 25 L50 45 L40 45 L55 70 L5 70 L20 45 L10 45 L22 25 L15 25 Z M27 70 L27 80 L33 80 L33 70 Z' fill='white'/%3E%3C/svg%3E");
    -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 60 80'%3E%3Cpath d='M30 5 L45 25 L38 25 L50 45 L40 45 L55 70 L5 70 L20 45 L10 45 L22 25 L15 25 Z M27 70 L27 80 L33 80 L33 70 Z' fill='white'/%3E%3C/svg%3E");
    mask-size: contain;
    -webkit-mask-size: contain;
    mask-repeat: no-repeat;
    -webkit-mask-repeat: no-repeat;
    filter: drop-shadow(0 0 8px var(--gold));
    animation: tree-glow 2s ease-in-out infinite alternate;
}

@keyframes tree-glow {
    from { filter: drop-shadow(0 0 5px var(--gold)); opacity: 0.9; }
    to { filter: drop-shadow(0 0 15px var(--gold)); opacity: 1; }
}

/* ==========================================================================
   COUPLE PLAY: Dirty Content Mask Overlays
   ========================================================================== */

.dirty-mask {
    position: relative;
    cursor: pointer;
    color: transparent;
    background: linear-gradient(135deg, rgba(255,20,147,0.12) 0%, rgba(255,105,180,0.08) 100%);
    border-radius: 3px;
    padding: 0 2px;
    transition: background 0.3s ease, color 0.3s ease;
    user-select: none;
    -webkit-user-select: none;
}

.dirty-mask::after {
    content: '';
    position: absolute;
    inset: 0;
    background: repeating-linear-gradient(
        120deg,
        transparent,
        transparent 3px,
        rgba(255,20,147,0.06) 3px,
        rgba(255,20,147,0.06) 6px
    );
    border-radius: 3px;
    pointer-events: none;
}

/* Subtle shimmer on hover to hint interactivity */
.dirty-mask:hover {
    background: linear-gradient(135deg, rgba(255,20,147,0.2) 0%, rgba(255,105,180,0.14) 100%);
}

/* Revealed state after consent accepted */
.dirty-revealed {
    color: inherit;
    background: none;
    cursor: default;
    transition: color 0.5s ease, background 0.5s ease;
}

.dirty-revealed::after {
    display: none;
}

/* Rewritten state after consent declined */
.dirty-rewritten {
    color: inherit;
    background: none;
    cursor: default;
    font-style: inherit;
}
}

/* =========================================================================
   COUPLE PLAY: MASK PRESENTATION LAYER
   ========================================================================= */

.mask-suggestion-row {
    margin: 20px 0;
    padding: 16px;
    border: 1px solid rgba(255, 215, 0, 0.2);
    border-radius: 8px;
    background: rgba(0, 0, 0, 0.3);
    text-align: center;
}

.mask-suggestion-label {
    font-size: 0.95em;
    color: var(--gold);
    margin-bottom: 10px;
    font-style: italic;
}

.mask-suggestion-select {
    width: 100%;
    max-width: 280px;
    padding: 8px 12px;
    background: #1a1a1a;
    color: var(--ink);
    border: 1px solid rgba(255, 215, 0, 0.3);
    border-radius: 6px;
    font-size: 0.9em;
    cursor: pointer;
    appearance: none;
    -webkit-appearance: none;
    text-align: center;
}

.mask-suggestion-select:focus {
    outline: none;
    border-color: var(--gold);
    box-shadow: 0 0 6px rgba(255, 215, 0, 0.15);
}

.mask-suggestion-note {
    font-size: 0.78em;
    color: #888;
    font-style: italic;
    margin-top: 8px;
}